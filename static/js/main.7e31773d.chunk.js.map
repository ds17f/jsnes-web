{"version":3,"sources":["config.js","RomLibrary.js","ListPage.js","ControlMapperRow.js","ControlsModal.js","FrameTimer.js","GamepadController.js","KeyboardController.js","Screen.js","utils.js","Speakers.js","Emulator.js","NesController.js","RunPage.js","App.js","index.js"],"names":["config","ROMS","owlia","name","description","href","target","rel","url","nomolos","croom","lj65","GOOGLE_ANALYTICS_CODE","process","REACT_APP_GOOGLE_ANALYTICS_CODE","SENTRY_URI","REACT_APP_SENTRY_URI","BASENAME","window","location","includes","parts","split","RomLibrary","getRomInfoByHash","hash","this","load","find","rom","save","file","Promise","resolve","reject","reader","FileReader","onload","readAsBinaryString","pFileReader","then","readFile","byteString","result","ab","ArrayBuffer","length","ia","Uint8Array","i","charCodeAt","crypto","subtle","digest","buffer","Array","from","map","b","toString","padStart","join","hashFile","savedRomInfo","localStorage","getItem","existingLibrary","JSON","parse","added","Date","now","newRomInfo","stringify","concat","setItem","delete","removeItem","filter","ListPage","props","deleteRom","updateLibrary","setState","romLibrary","handleDragOver","e","preventDefault","dataTransfer","dropEffect","handleDrop","items","getAsFile","files","history","push","pathname","state","className","onDragOver","onDrop","ListGroup","Object","keys","sort","key","to","rootRunPath","encodeURIComponent","a","onClick","title","Component","ControlMapperRow","playerOneButton","playerTwoButton","waitingForKey","handleClick","bind","button","playerButtons","console","log","prevProps","prevState","gamepadButton","newButton","searchButton","gamepadConfig","buttonId","buttons","searchNewButton","prevGamepadConfig","some","b2","waitingForKeyPlayer","gamepadButtonName","type","code","value","playerGamepadId","configs","prevButton","newState","currentPromptButton","player","buttonName","GAMEPAD_ICON","ControlsModal","undefined","modified","handleKeyDown","handleGamepadButtonDown","listenForKey","controllerIcon","gamepadId","controllerIconAlt","setKeys","setGamepadConfig","removeKeyListener","promptButton","document","addEventListener","buttonInfo","playerId","slice","newConfig","assign","event","newKeys","keyCode","String","toUpperCase","removeEventListener","Modal","isOpen","toggle","ModalHeader","ModalBody","Table","src","alt","Controller","BUTTON_LEFT","BUTTON_SELECT","BUTTON_RIGHT","BUTTON_UP","BUTTON_DOWN","BUTTON_A","BUTTON_B","BUTTON_START","ModalFooter","Button","outline","color","FrameTimer","onAnimationFrame","time","requestAnimationFrame","excess","interval","newFrameTime","lastFrameTime","numFrames","Math","round","generateFrame","onWriteFrame","timeToNextFrame","setTimeout","onGenerateFrame","running","_requestID","cancelAnimationFrame","GamepadController","options","disableIfGamepadEnabled","callback","self","_getPlayerNumberFromGamepad","gamepad","id","poll","gamepads","navigator","getGamepads","webkitGetGamepads","usedPlayers","gamepadIndex","previousGamepad","gamepadState","previousButtons","buttonCallback","axes","axis","previousAxis","previousButton","pressed","playerNumber","indexOf","configButtons","configButton","onButtonDown","onButtonUp","f","loadGamepadConfig","startPolling","stop","stopped","loop","KEYS","88","89","90","17","13","38","40","37","39","103","105","99","97","104","98","100","102","KeyboardController","loadKeys","handleKeyUp","handleKeyPress","Screen","setBuffer","y","x","buf32","writeBuffer","imageData","data","set","buf8","context","putImageData","fitInParent","parent","canvas","parentNode","parentWidth","clientWidth","parentHeight","clientHeight","style","width","height","handleMouseDown","onMouseDown","scale","parseFloat","rect","getBoundingClientRect","clientX","left","clientY","top","onMouseUp","ref","initCanvas","getContext","getImageData","fillStyle","fillRect","buf","Uint8ClampedArray","Uint32Array","img","Image","toDataURL","handleError","error","errorInfo","Raven","captureException","extra","Speakers","onBufferUnderrun","writeSample","right","size","bufferSize","deqN","enq","onaudioprocess","outputBuffer","getChannelData","samples","j","RingBuffer","AudioContext","myCtx","sampleRate","close","audioCtx","scriptNode","createScriptProcessor","connect","destination","disconnect","catch","Emulator","start","frameTimer","speakers","fpsInterval","setInterval","nes","getFPS","clearInterval","screen","frame","zapperMove","zapperFireDown","zapperFireUp","actualSize","desiredSize","paused","NES","onFrame","onStatusUpdate","onAudioSample","getSampleRate","wrap","gamepadController","buttonDown","buttonUp","gamepadPolling","keyboardController","loadROM","romData","mouseToKeyPressHandlers","originalColor","touchStartHandler","persist","fill","touchEndHandler","defaultPlayer1Controller","scalePercentage","dPadUp","dPadDown","dPadRight","dPadLeft","select","NesController","version","xmlns","viewBox","enableBackground","d","stroke","strokeWidth","strokeLinecap","onTouchCancel","onTouchEnd","onTouchStart","transform","RunPage","match","params","slug","isLocalROM","test","romHash","romInfo","romName","localROMData","handleLoaded","currentRequest","path","handleProgress","req","XMLHttpRequest","open","overrideMimeType","status","responseText","Error","statusText","onerror","onprogress","send","loadBinary","err","message","lengthComputable","loadedPercent","loaded","total","loading","handlePauseResume","layout","navbarHeight","getComputedStyle","navbar","screenContainer","innerHeight","emulator","toggleControlsModal","controlsModalOpen","el","disabled","Progress","position","abort","App","recordPageview","GoogleAnalytics","pageview","initialize","basename","exact","component","render","install","ReactDOM","getElementById"],"mappings":"iZAqGeA,EAnGA,CACbC,KAAM,CACJC,MAAO,CACLC,KAAM,uBACNC,YACE,8BACE,uBACEC,KAAK,4DACLC,OAAO,SACPC,IAAI,uBAHN,0BAMK,IAPP,IAQI,IACF,uBACEF,KAAK,4CACLC,OAAO,SACPC,IAAI,uBAHN,sBASJC,IAAK,kEAEPC,QAAS,CACPN,KAAM,+BACNC,YACE,8BACE,uBACEC,KAAK,6DACLC,OAAO,SACPC,IAAI,uBAHN,4BAMK,IAPP,IAQI,IACF,uBACEF,KAAK,8CACLC,OAAO,SACPC,IAAI,uBAHN,sBASJC,IAAK,oEAEPE,MAAO,CACLP,KAAM,qBACNC,YACE,8BACE,uBACEC,KAAK,uCACLC,OAAO,SACPC,IAAI,uBAHN,sBAMK,IAPP,qBAWFC,IACE,wEAEJG,KAAM,CACJR,KAAM,OACNC,YACE,8BACE,uBACEC,KAAK,gCACLC,OAAO,SACPC,IAAI,uBAHN,sBAMK,IAPP,qBAWFC,IAAK,uEAGTI,sBAAuBC,oHAAYC,gCACnCC,WAAYF,oHAAYG,qBACxBC,SAAU,WACR,IAAMT,EAAMU,OAAOC,SAASd,KAE5B,GAAIG,EAAIY,SAAS,aAAc,CAC7B,IAAMC,EAAQb,EAAIc,MAAM,KAExB,MAAM,IAAN,OAAWD,EAAM,IAKnB,MAAO,KC1BIE,EA9CI,CACjBC,iBAAkB,SAASC,GACzB,OAAOC,KAAKC,OAAOC,MAAK,SAAAC,GAAG,OAAIA,EAAIJ,OAASA,MAE9CK,KAAM,SAASC,GACb,OA9BgB,SAASA,GAC3B,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3B,IAAIC,EAAS,IAAIC,WACjBD,EAAOE,OAASJ,EAChBE,EAAOG,mBAAmBP,MA0BnBQ,CAAYR,GAChBS,MAAK,SAASC,GACb,IAAMC,EAAaD,EAASnC,OAAOqC,OACnC,OAzBS,SAASD,GAUxB,IATA,IAMME,EAAK,IAAIC,YAAYH,EAAWI,QAClCC,EAAK,IAAIC,WAAWJ,GAEfK,EAAI,EAAGA,EAAIP,EAAWI,OAAQG,IACrCF,EAAGE,GAAKP,EAAWQ,WAAWD,GAGhC,OAAOE,OAAOC,OAAOC,OAAO,QAAST,GAAIJ,MAb3B,SAAAc,GACZ,OAAOC,MAAMC,KAAK,IAAIR,WAAWM,IAC9BG,KAAI,SAAAC,GAAC,OAAIA,EAAEC,SAAS,IAAIC,SAAS,EAAG,QACpCC,KAAK,OAqBGC,CAASpB,GAAYF,MAAK,SAAAf,GAC/B,MAAO,CAAEA,OAAMiB,oBAGlBF,MAAK,YAA2B,IAAxBf,EAAuB,EAAvBA,KAAMiB,EAAiB,EAAjBA,WACPqB,EAAeC,aAAaC,QAAQ,gBACpCC,EAAkBH,EAAeI,KAAKC,MAAML,GAAgB,GAE5DlC,EAAM,CACV1B,KAAM4B,EAAK5B,KACXsB,KAAMA,EACN4C,MAAOC,KAAKC,OAGRC,EAAaL,KAAKM,UAAUP,EAAgBQ,OAAO,CAAC7C,KAK1D,OAHAmC,aAAaW,QAAQ,eAAgBH,GACrCR,aAAaW,QAAQ,QAAUlD,EAAMiB,GAE9Bb,MAGbF,KAAM,WAEJ,OADkBqC,aAAaC,QAAQ,iBAElBE,KAAKC,MAAMJ,aAAaC,QAAQ,kBAD9B,IAIzBW,OAAQ,SAASnD,GACf,IAAMyC,EAAkBxC,KAAKC,OAC7BqC,aAAaa,WAAW,QAAUpD,GAClCuC,aAAaW,QACX,eACAR,KAAKM,UAAUP,EAAgBY,QAAO,SAAAjD,GAAG,OAAIA,EAAIJ,OAASA,SCyDjDsD,E,kDA/Gb,WAAYC,GAAQ,IAAD,8BACjB,cAAMA,IAkFRC,UAAY,SAAAxD,GACVF,EAAWqD,OAAOnD,GAClB,EAAKyD,iBArFY,EAwFnBA,cAAgB,WACd,EAAKC,SAAS,CAAEC,WAAY7D,EAAWI,UAzFtB,EA4FnB0D,eAAiB,SAAAC,GACfA,EAAEC,iBACFD,EAAEE,aAAaC,WAAa,QA9FX,EAiGnBC,WAAa,SAAAJ,GACXA,EAAEC,iBAEF,IAAMxD,EAAOuD,EAAEE,aAAaG,MACxBL,EAAEE,aAAaG,MAAM,GAAGC,YACxBN,EAAEE,aAAaK,MAAM,GAEzBtE,EAAWO,KAAKC,GAAMS,MAAK,SAAAX,GACzB,EAAKqD,gBACL,EAAKF,MAAMc,QAAQC,KAAK,CAAEC,UAAanE,EAAIJ,WAxG7C,EAAKwE,MAAQ,CACXb,WAAY7D,EAAWI,QAHR,E,0CAMnB,WAAU,IAAD,OACP,OACE,yBACEuE,UAAU,YACVC,WAAYzE,KAAK2D,eACjBe,OAAQ1E,KAAKgE,YAEb,yBAAKQ,UAAU,2BACb,yBAAKA,UAAU,8BACb,yBAAKA,UAAU,YACb,4BAAQA,UAAU,QAChB,wBAAIA,UAAU,QAAd,SACA,wDAC6B,IAC3B,uBAAG7F,KAAK,mCAAR,uBAMJ,kBAACgG,EAAA,EAAD,CAAWH,UAAU,QAClBI,OAAOC,KAAKvG,EAAOC,MACjBuG,OACA/C,KAAI,SAAAgD,GAAG,OACN,kBAAC,IAAD,CACEA,IAAKA,EACLC,GAAIC,QAAqBC,mBAAmBH,GAC5CP,UAAU,mBAETlG,EAAOC,KAAKwG,GAAZ,KACD,0BAAMP,UAAU,eAAhB,eAKR,sHAKCxE,KAAKuE,MAAMb,WAAWtC,OAAS,EAC9B,6BACE,iDAEA,kBAACuD,EAAA,EAAD,CAAWH,UAAU,QAClBxE,KAAKuE,MAAMb,WACToB,MAAK,SAACK,EAAGnD,GAAJ,OAAU,IAAIY,KAAKZ,EAAEW,OAAS,IAAIC,KAAKuC,EAAExC,UAC9CZ,KAAI,SAAA5B,GAAG,OACN,kBAAC,IAAD,CACE4E,IAAK5E,EAAIJ,KACTiF,GA3DD,UA2DwB7E,EAAIJ,KAC3ByE,UAAU,mBAETrE,EAAI1B,KACL,0BACE2G,QAAS,SAAAxB,GACPA,EAAEC,iBACF,EAAKN,UAAUpD,EAAIJ,OAErByE,UAAU,SACVa,MAAM,UANR,QAUA,0BAAMb,UAAU,eAAhB,gBAKR,a,GA5EKc,a,+FCmKRC,E,kDA3Kb,WAAYjC,GAAQ,IAAD,8BACjB,cAAMA,IACDiB,MAAQ,CACXiB,gBAAiB,GACjBC,gBAAiB,GACjBC,cAAe,GAEjB,EAAKC,YAAc,EAAKA,YAAYC,KAAjB,gBAPF,E,qDAUnB,WACE,IAAIf,EAAO7E,KAAKsD,MAAMuB,KAClBgB,EAAS7F,KAAKsD,MAAMuC,OACpBC,EAAgB,GACpB,IAAK,IAAIf,KAAOF,EACO,IAAjBA,EAAKE,GAAK,IAAYF,EAAKE,GAAK,KAAOc,GACzCC,EAAc,GAAKjB,EAAKE,GAAK,GAC7BgB,QAAQC,IAAIF,EAAc,KACA,IAAjBjB,EAAKE,GAAK,IAAYF,EAAKE,GAAK,KAAOc,IAChDC,EAAc,GAAKjB,EAAKE,GAAK,IAGjC/E,KAAKyD,SAAS,CACZ+B,gBAAiBM,EAAc,GAC/BL,gBAAiBK,EAAc,O,gCAInC,SAAmBG,EAAWC,GAC5B,IAGIC,EACAC,EAJAvB,EAAO7E,KAAKsD,MAAMuB,KAClBgB,EAAS7F,KAAKsD,MAAMuC,OACpBC,EAAgB,GAIpB,IAAK,IAAIf,KAAOF,EACO,IAAjBA,EAAKE,GAAK,IAAYF,EAAKE,GAAK,KAAOc,GACzCC,EAAc,GAAKjB,EAAKE,GAAK,GAC7BgB,QAAQC,IAAIF,EAAc,KACA,IAAjBjB,EAAKE,GAAK,IAAYF,EAAKE,GAAK,KAAOc,IAChDC,EAAc,GAAKjB,EAAKE,GAAK,IAIjC,IAAIsB,EAAe,SAACC,EAAeC,GACjC,OAAOD,EAAcE,QAAQpD,QAAO,SAAApB,GAAC,OAAIA,EAAEuE,WAAaA,KAAU,IAGhEE,EAAkB,SAACC,EAAmBJ,GACxC,OAAOA,EAAcE,QAAQpD,QAAO,SAAApB,GAClC,OACG0E,IACAA,EAAkBF,QAAQG,MAAK,SAAAC,GAAE,OAAIA,EAAGL,WAAavE,EAAEuE,eAEzD,IAGDb,EAAgB,EAChBmB,EAAsB,EAEtBC,EAAoB,SAAAX,GACtB,MAA2B,WAAvBA,EAAcY,KAA0B,OAASZ,EAAca,KACxC,SAAvBb,EAAcY,KACT,QAAUZ,EAAca,KAAO,IAAMb,EAAcc,WAD5D,GAIF,GAAIjH,KAAKsD,MAAMgD,eAAiBtG,KAAKsD,MAAMgD,cAAcY,gBAAiB,CACxE,IAAMA,EAAkBlH,KAAKsD,MAAMgD,cAAcY,gBAC7CA,EAAgB,KAClBpB,EAAc,GAAK,GACnBK,EAAgBE,EACdrG,KAAKsD,MAAMgD,cAAca,QAAQD,EAAgB,IACjDrB,GAEFO,EAAYK,EACVR,EAAUK,cAAca,QAAQD,EAAgB,IAChDlH,KAAKsD,MAAMgD,cAAca,QAAQD,EAAgB,KAE/Cf,EACFL,EAAc,GAAKgB,EAAkBX,GAEjCC,GAAaA,EAAUG,WAAavG,KAAKsD,MAAM8D,aAC5C1B,IACHA,EAAgB,EAChBmB,EAAsB,KAM1BK,EAAgB,KAClBpB,EAAc,GAAK,GACnBK,EAAgBE,EACdrG,KAAKsD,MAAMgD,cAAca,QAAQD,EAAgB,IACjDrB,GAEFO,EAAYK,EACVR,EAAUK,cAAca,QAAQD,EAAgB,IAChDlH,KAAKsD,MAAMgD,cAAca,QAAQD,EAAgB,KAE/Cf,EACFL,EAAc,GAAKgB,EAAkBX,GAEjCC,GAAaA,EAAUG,WAAavG,KAAKsD,MAAM8D,aAC5C1B,IACHA,EAAgB,EAChBmB,EAAsB,KAOhC,IAAIQ,EAAW,GAEX3B,GACF1F,KAAKsD,MAAMqC,YAAY,CAACkB,EAAqB7G,KAAKsD,MAAMuC,SAIxDK,EAAUV,kBAAoBM,EAAc,IAC5CI,EAAUT,kBAAoBK,EAAc,KAE5CuB,EAAS7B,gBAAkBM,EAAc,GACzCuB,EAAS5B,gBAAkBK,EAAc,IAGvCJ,EACF2B,EAAS3B,cAAgBA,EACY,IAA5BQ,EAAUR,cACf1F,KAAKsD,MAAMgE,sBAAwBtH,KAAKsD,MAAMuC,SAChDwB,EAAS3B,cAAgB,GAEU,IAA5BQ,EAAUR,eACf1F,KAAKsD,MAAMgE,sBAAwBtH,KAAKsD,MAAMuC,SAChDwB,EAAS3B,cAAgB,GAIzBd,OAAOC,KAAKwC,GAAUjG,OAAS,GACjCpB,KAAKyD,SAAS4D,K,yBAIlB,SAAYE,GACVvH,KAAKsD,MAAMqC,YAAY,CAAC4B,EAAQvH,KAAKsD,MAAMuC,SAC3C7F,KAAKyD,SAAS,CACZiC,cAAe6B,M,oBAInB,WAAU,IAAD,OAEP,OACE,4BACE,4BAAKvH,KAAKsD,MAAMkE,YAChB,wBAAIpC,QAAS,kBAAM,EAAKO,YAAY,KACJ,IAA7B3F,KAAKuE,MAAMmB,cALE,yBAOV1F,KAAKuE,MAAMiB,iBAEjB,wBAAIJ,QAAS,kBAAM,EAAKO,YAAY,KACJ,IAA7B3F,KAAKuE,MAAMmB,cAVE,yBAYV1F,KAAKuE,MAAMkB,sB,GArKMH,aCUzBmC,EAAe,4BAiQNC,E,kDA7Pb,WAAYpE,GAAQ,IAAD,8BACjB,cAAMA,IACDiB,MAAQ,CACX+B,cAAehD,EAAMgD,cACrBzB,KAAMvB,EAAMuB,KACZgB,YAAQ8B,EACRC,UAAU,GAEZ,EAAKC,cAAgB,EAAKA,cAAcjC,KAAnB,gBACrB,EAAKkC,wBAA0B,EAAKA,wBAAwBlC,KAA7B,gBAC/B,EAAKmC,aAAe,EAAKA,aAAanC,KAAlB,gBAEpB,EAAKrB,MAAM+B,cAAgB,EAAK/B,MAAM+B,eAAiB,GACvD,EAAK/B,MAAM+B,cAAcY,gBAAkB,EAAK3C,MAAM+B,cACnDY,iBAAmB,CAAC,KAAM,MAC7B,EAAK3C,MAAM+B,cAAca,QAAU,EAAK5C,MAAM+B,cAAca,SAAW,GAEvE,EAAK5C,MAAMyD,eAAiB,EAAKzD,MAAM+B,cAAcY,gBAAgBnF,KACnE,SAAAkG,GAAS,OAAKA,EAAYR,EArBV,yBAuBlB,EAAKlD,MAAM2D,kBAAoB,EAAK3D,MAAM+B,cAAcY,gBAAgBnF,KACtE,SAAAkG,GAAS,OAAKA,EAAY,UAAY,cAExC,EAAK1D,MAAM+C,qBAAuB,EAvBjB,E,wDA0BnB,WACMtH,KAAKuE,MAAMqD,WACb5H,KAAKsD,MAAM6E,QAAQnI,KAAKuE,MAAMM,MAC9B7E,KAAKsD,MAAM8E,iBAAiBpI,KAAKuE,MAAM+B,gBAEzCtG,KAAKqI,sB,0BAGP,SAAaxC,GACX,IAAIyB,EAAsBzB,EAAO,GAEjC7F,KAAKqI,oBACLrI,KAAKyD,SAAS,CAAEoC,SAAQyB,wBACxBtH,KAAKsD,MAAMgF,aAAatI,KAAK8H,yBAC7BS,SAASC,iBAAiB,UAAWxI,KAAK6H,iB,qCAG5C,SAAwBY,GACtBzI,KAAKqI,oBAEL,IAAIxC,EAAS7F,KAAKuE,MAAMsB,OAElB6C,EAAW7C,EAAO,GAClBU,EAAWV,EAAO,GAElBoC,EAAYQ,EAAWR,UACvB3B,EAAgBtG,KAAKuE,MAAM+B,cAG3BY,EAAkBZ,EAAcY,gBAAgByB,MAAM,GACtDC,EAAY,GAElB1B,EAAgBwB,EAAW,GAAKT,EAEhC,IAIM7B,EAAY,CAChBY,KAAMyB,EAAWzB,KACjBD,KAAM0B,EAAW1B,KACjBR,SAAUA,EACVU,MAAOwB,EAAWxB,OAEpB2B,EAAUX,GAAa,CACrBzB,SAAUF,EAAca,QAAQc,IAAc,CAAEzB,QAAS,KAAMA,QAC5DpD,QAZkB,SAAApB,GACrB,OAAOA,EAAEuE,WAAaA,KAYnBvD,OAAO,CAACoD,KAGb,IAAMe,EAAUvC,OAAOiE,OAAO,GAAIvC,EAAca,QAASyB,GAEzD5I,KAAKyD,SAAS,CACZ6C,cAAe,CACba,QAASA,EACTD,gBAAiBA,GAEnBI,qBAAsB,EACtBU,eAAgBd,EAAgBnF,KAAI,SAAAkG,GAAS,OAC3CA,EAAYR,EAxFE,yBA0FhBG,UAAU,M,2BAId,SAAckB,GACZ9I,KAAKqI,oBAEL,IAAIxC,EAAS7F,KAAKuE,MAAMsB,OACpBhB,EAAO7E,KAAKuE,MAAMM,KAClBkE,EAAU,GACd,IAAK,IAAIhE,KAAOF,EACVA,EAAKE,GAAK,KAAOc,EAAO,IAAMhB,EAAKE,GAAK,KAAOc,EAAO,KACxDkD,EAAQhE,GAAOF,EAAKE,IAIxB,IAAMmC,EAAkBlH,KAAKuE,MAAM+B,cAAcY,gBAAgByB,MAAM,GAEvEzB,EADiBrB,EAAO,GACG,GAAK,KAEhC7F,KAAKyD,SAAS,CACZoB,KAAK,2BACAkE,GADD,kBAEDD,EAAME,QAFL,sBAGGnD,EAAO8C,MAAM,EAAG,IAHnB,CAIAG,EAAM/D,IAAI3D,OAAS,EAAI0H,EAAM/D,IAAMkE,OAAOH,EAAM/D,KAAKmE,kBAGzDrD,YAAQ8B,EACRrB,cAAe,CACba,QAASnH,KAAKuE,MAAM+B,cAAca,QAClCD,gBAAiBA,GAEnBI,qBAAsB,EACtBU,eAAgBd,EAAgBnF,KAAI,SAAAkG,GAAS,OAC3CA,EAAYR,EA7HE,yBA+HhBS,kBAAmBhB,EAAgBnF,KAAI,SAAAkG,GAAS,OAC9CA,EAAY,UAAY,cAE1BL,UAAU,M,+BAId,WACE5H,KAAKsD,MAAMgF,aAAa,MACxBC,SAASY,oBAAoB,UAAWnJ,KAAK6H,iB,oBAG/C,WACE,OACE,kBAACuB,EAAA,EAAD,CACEC,OAAQrJ,KAAKsD,MAAM+F,OACnBC,OAAQtJ,KAAKsD,MAAMgG,OACnB9E,UAAU,iBAEV,kBAAC+E,EAAA,EAAD,CAAaD,OAAQtJ,KAAKsD,MAAMgG,QAAhC,YACA,kBAACE,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,KACE,+BACE,4BACE,sCACA,uCAEE,yBACEjF,UAAU,kBACVkF,IAAK1J,KAAKuE,MAAMyD,eAAe,GAC/B2B,IAAK3J,KAAKuE,MAAM2D,kBAAkB,MAGtC,uCAEE,yBACE1D,UAAU,kBACVkF,IAAK1J,KAAKuE,MAAMyD,eAAe,GAC/B2B,IAAK3J,KAAKuE,MAAM2D,kBAAkB,QAK1C,+BACE,kBAAC,EAAD,CACEV,WAAW,OACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWC,YACnBzC,WAAYwC,aAAWE,cACvBjF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,gBAE5B,kBAAC,EAAD,CACEkB,WAAW,QACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWG,aACnB3C,WAAYwC,aAAWC,YACvBhF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,gBAE5B,kBAAC,EAAD,CACEkB,WAAW,KACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWI,UACnB5C,WAAYwC,aAAWG,aACvBlF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,gBAE5B,kBAAC,EAAD,CACEkB,WAAW,OACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWK,YACnB7C,WAAYwC,aAAWI,UACvBnF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,gBAE5B,kBAAC,EAAD,CACEkB,WAAW,IACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWM,SACnB9C,WAAYwC,aAAWK,YACvBpF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,gBAE5B,kBAAC,EAAD,CACEkB,WAAW,IACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWO,SACnB/C,WAAYwC,aAAWM,SACvBrF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,gBAE5B,kBAAC,EAAD,CACEkB,WAAW,QACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWQ,aACnBhD,WAAYwC,aAAWO,SACvBtF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,gBAE5B,kBAAC,EAAD,CACEkB,WAAW,SACXF,oBAAqBtH,KAAKuE,MAAM+C,oBAChCzB,OAAQ+D,aAAWE,cACnB1C,WAAYwC,aAAWQ,aACvBvF,KAAM7E,KAAKuE,MAAMM,KACjBc,YAAa3F,KAAK+H,aAClBzB,cAAetG,KAAKuE,MAAM+B,mBAKlC,kBAAC+D,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CAAQC,SAAO,EAACC,MAAM,UAAUpF,QAASpF,KAAKsD,MAAMgG,QAApD,e,GArPkBhE,aCbPmF,E,WACnB,WAAYnH,GAAQ,IAAD,gCA+BnBoH,iBAAmB,SAAAC,GACjB,EAAKC,wBAEL,IAAIC,EAASF,EAAO,EAAKG,SAIrBC,EAAeJ,EAAOE,EAG1B,GAAK,EAAKG,cAAV,CAKA,IAAIC,EAAYC,KAAKC,OAClBJ,EAAe,EAAKC,eAAiB,EAAKF,UAI7C,GAAkB,IAAdG,EAAJ,CAMA,EAAKG,gBACL,EAAKC,eAOL,IADA,IAAIC,EAAkB,EAAKR,SAAWD,EAC7BtJ,EAAI,EAAGA,EAAI0J,EAAW1J,IAC7BgK,YAAW,WACT,EAAKH,kBACH7J,EAAI+J,EAAmBL,GAEzBA,EAAY,GAAGlF,QAAQC,IAAI,OAAQiF,EAAY,EAAG,EAAKD,qBA5BzD,EAAKA,cAAgBD,GAxCvB/K,KAAKwL,gBAAkBlI,EAAMkI,gBAE7BxL,KAAKqL,aAAe/H,EAAM+H,aAC1BrL,KAAK0K,iBAAmB1K,KAAK0K,iBAAiB9E,KAAK5F,MACnDA,KAAKyL,SAAU,EACfzL,KAAK8K,SAAW,IAVR,OAWR9K,KAAKgL,eAAgB,E,yCAGvB,WACEhL,KAAKyL,SAAU,EACfzL,KAAK4K,0B,kBAGP,WACE5K,KAAKyL,SAAU,EACXzL,KAAK0L,YAAYlM,OAAOmM,qBAAqB3L,KAAK0L,YACtD1L,KAAKgL,eAAgB,I,mCAGvB,WACEhL,KAAK0L,WAAalM,OAAOoL,sBAAsB5K,KAAK0K,oB,2BAGtD,WACE1K,KAAKwL,kBACLxL,KAAKgL,eAAiBhL,KAAK8K,a,KC/BVc,E,aACnB,WAAYC,GAAU,IAAD,gCAOrBC,wBAA0B,SAAAC,GACxB,IAAIC,EAAO,EACX,OAAO,SAACtD,EAAUnC,GAChB,IAAKyF,EAAK1F,cACR,OAAOyF,EAASrD,EAAUnC,GAG5B,IAAIW,EAAkB8E,EAAK1F,cAAcY,gBACzC,OAAKA,GAAoBA,EAAgBwB,EAAW,QAApD,EAESqD,EAASrD,EAAUnC,KAjBX,KAsBrB0F,4BAA8B,SAAAC,GAC5B,OAAI,EAAK5F,cAAcY,gBAAgB,KAAOgF,EAAQC,GAC7C,EAGL,EAAK7F,cAAcY,gBAAgB,KAAOgF,EAAQC,GAC7C,EAGF,GA/BY,KAkCrBC,KAAO,WAOL,IANA,IAAMC,EAAWC,UAAUC,YACvBD,UAAUC,cACVD,UAAUE,oBAERC,EAAc,GAEXC,EAAe,EAAGA,EAAeL,EAASjL,OAAQsL,IAAgB,CACzE,IAAMR,EAAUG,EAASK,GACnBC,EAAkB,EAAKC,aAAaF,GAE1C,GAAKR,EAIL,GAAKS,EAAL,CAKA,IAAMnG,EAAU0F,EAAQ1F,QAClBqG,EAAkBF,EAAgBnG,QAExC,GAAI,EAAKsG,eAAgB,CACvB,IAAK,IAAI9F,EAAO,EAAGA,EAAOkF,EAAQa,KAAK3L,OAAQ4F,IAAQ,CACrD,IAAMgG,EAAOd,EAAQa,KAAK/F,GACpBiG,EAAeN,EAAgBI,KAAK/F,IAE5B,IAAVgG,IAAiC,IAAlBC,GACjB,EAAKH,eAAe,CAClB7E,UAAWiE,EAAQC,GACnBpF,KAAM,OACNC,KAAMA,EACNC,MAAO+F,IAIE,IAATA,GAA+B,IAAjBC,GAChB,EAAKH,eAAe,CAClB7E,UAAWiE,EAAQC,GACnBpF,KAAM,OACNC,KAAMA,EACNC,MAAO+F,IAKb,IAAK,IAAIhG,EAAO,EAAGA,EAAOR,EAAQpF,OAAQ4F,IAAQ,CAChD,IAAMnB,EAASW,EAAQQ,GACjBkG,EAAiBL,EAAgB7F,GACnCnB,EAAOsH,UAAYD,EAAeC,SACpC,EAAKL,eAAe,CAClB7E,UAAWiE,EAAQC,GACnBpF,KAAM,SACNC,KAAMA,UAIP,GAAI,EAAKV,cAAe,CAC7B,IAAI8G,EAAe,EAAKnB,4BAA4BC,GACpD,GAAIO,EAAYrL,OAAS,KACoB,IAAvCqL,EAAYY,QAAQD,MACtBA,EACmB,IAAGA,EAAe,GAEvCX,EAAYpI,KAAK+I,GAEb,EAAK9G,cAAca,QAAQ+E,EAAQC,KAIrC,IAHA,IAAMmB,EAAgB,EAAKhH,cAAca,QAAQ+E,EAAQC,IACtD3F,QAEMjF,EAAI,EAAGA,EAAI+L,EAAclM,OAAQG,IAAK,CAC7C,IAAMgM,EAAeD,EAAc/L,GACnC,GAA0B,WAAtBgM,EAAaxG,KAAmB,CAClC,IAAMC,EAAOuG,EAAavG,KACpBnB,EAASW,EAAQQ,GACjBkG,EAAiBL,EAAgB7F,GAEnCnB,EAAOsH,UAAYD,EAAeC,QACpC,EAAKK,aAAaJ,EAAcG,EAAahH,WACnCV,EAAOsH,SAAWD,EAAeC,SAC3C,EAAKM,WAAWL,EAAcG,EAAahH,eAExC,GAA0B,SAAtBgH,EAAaxG,KAAiB,CACvC,IAAMC,EAAOuG,EAAavG,KACpBgG,EAAOd,EAAQa,KAAK/F,GACpBiG,EAAeN,EAAgBI,KAAK/F,GAGxCgG,IAASO,EAAatG,OACtBgG,IAAiBM,EAAatG,OAE9B,EAAKuG,aAAaJ,EAAcG,EAAahH,UAI7CyG,IAASO,EAAatG,OACtBgG,IAAiBM,EAAatG,OAE9B,EAAKwG,WAAWL,EAAcG,EAAahH,YAQvD,EAAKqG,aAAaF,GAAgB,CAChClG,QAASA,EAAQzE,KAAI,SAAAC,GACnB,MAAO,CAAEmL,QAASnL,EAAEmL,YAEtBJ,KAAMb,EAAQa,KAAKpE,MAAM,SA/FzB,EAAKiE,aAAaF,GAAgBR,IAlDnB,KAsJrB5D,aAAe,SAAAoF,GAIX,EAAKZ,eAHFY,EAGmB,SAAAjF,GACpB,EAAKqE,eAAiB,KACtBY,EAAEjF,IAJkBiF,GAxJL,KAiKrBC,kBAAoB,WAClB,IAAIrH,EACJ,KACEA,EAAgBhE,aAAaC,QAAQ,oBAEnC+D,EAAgB7D,KAAKC,MAAM4D,IAE7B,MAAO1C,GACPmC,QAAQC,IAAI,iDAAkDpC,GAGhE,EAAK0C,cAAgBA,GA5KF,KA+KrB8B,iBAAmB,SAAA9B,GACjB,IACEhE,aAAaW,QAAQ,gBAAiBR,KAAKM,UAAUuD,IACrD,EAAKA,cAAgBA,EACrB,MAAO1C,GACPmC,QAAQC,IAAI,iDApLK,KAwLrB4H,aAAe,WACb,IAAMtB,UAAUC,cAAeD,UAAUE,kBACvC,MAAO,CAAEqB,KAAM,cAGjB,IAAIC,GAAU,EASd,OAFAlD,uBANa,SAAPmD,IACAD,IAEJ,EAAK1B,OACLxB,sBAAsBmD,OAIjB,CACLF,KAAM,WACJC,GAAU,KAvMd9N,KAAKwN,aAAe3B,EAAQ2B,aAC5BxN,KAAKyN,WAAa5B,EAAQ4B,WAC1BzN,KAAK4M,aAAe,GACpB5M,KAAK8M,eAAiB,QCFpBkB,EAAO,CACXC,GAAI,CAAC,EAAGrE,aAAWM,SAAU,KAC7BgE,GAAI,CAAC,EAAGtE,aAAWO,SAAU,KAC7BgE,GAAI,CAAC,EAAGvE,aAAWO,SAAU,KAC7BiE,GAAI,CAAC,EAAGxE,aAAWE,cAAe,cAClCuE,GAAI,CAAC,EAAGzE,aAAWQ,aAAc,SACjCkE,GAAI,CAAC,EAAG1E,aAAWI,UAAW,MAC9BuE,GAAI,CAAC,EAAG3E,aAAWK,YAAa,QAChCuE,GAAI,CAAC,EAAG5E,aAAWC,YAAa,QAChC4E,GAAI,CAAC,EAAG7E,aAAWG,aAAc,SACjC2E,IAAK,CAAC,EAAG9E,aAAWM,SAAU,SAC9ByE,IAAK,CAAC,EAAG/E,aAAWO,SAAU,SAC9ByE,GAAI,CAAC,EAAGhF,aAAWE,cAAe,SAClC+E,GAAI,CAAC,EAAGjF,aAAWQ,aAAc,SACjC0E,IAAK,CAAC,EAAGlF,aAAWI,UAAW,SAC/B+E,GAAI,CAAC,EAAGnF,aAAWK,YAAa,SAChC+E,IAAK,CAAC,EAAGpF,aAAWC,YAAa,SACjCoF,IAAK,CAAC,EAAGrF,aAAWG,aAAc,UAGfmF,E,aACnB,WAAYrD,GAAU,IAAD,gCAKrBsD,SAAW,WACT,IAAItK,EACJ,KACEA,EAAOvC,aAAaC,QAAQ,WAE1BsC,EAAOpC,KAAKC,MAAMmC,IAEpB,MAAOjB,GACPmC,QAAQC,IAAI,wCAAyCpC,GAGvD,EAAKiB,KAAOA,GAAQmJ,GAhBD,KAmBrB7F,QAAU,SAAAY,GACR,IACEzG,aAAaW,QAAQ,OAAQR,KAAKM,UAAUgG,IAC5C,EAAKlE,KAAOkE,EACZ,MAAOnF,GACPmC,QAAQC,IAAI,wCAxBK,KA4BrB6B,cAAgB,SAAAjE,GACd,IAAImB,EAAM,EAAKF,KAAKjB,EAAEoF,SAClBjE,IACF,EAAKyI,aAAazI,EAAI,GAAIA,EAAI,IAC9BnB,EAAEC,mBAhCe,KAoCrBuL,YAAc,SAAAxL,GACZ,IAAImB,EAAM,EAAKF,KAAKjB,EAAEoF,SAClBjE,IACF,EAAK0I,WAAW1I,EAAI,GAAIA,EAAI,IAC5BnB,EAAEC,mBAxCe,KA4CrBwL,eAAiB,SAAAzL,GACfA,EAAEC,kBA5CF7D,KAAKwN,aAAe3B,EAAQ2B,aAC5BxN,KAAKyN,WAAa5B,EAAQ4B,cC+Ef6B,G,kNAlDbC,UAAY,SAAA3N,GAEV,IADA,IAAIL,EAAI,EACCiO,EAAI,EAAGA,EArDE,MAqDmBA,EACnC,IAAK,IAAIC,EAAI,EAAGA,EAvDD,MAuDqBA,EAClClO,EAAQ,IAAJiO,EAAUC,EAEd,EAAKC,MAAMnO,GAAK,WAAaK,EAAOL,I,EAK1CoO,YAAc,WACZ,EAAKC,UAAUC,KAAKC,IAAI,EAAKC,MAC7B,EAAKC,QAAQC,aAAa,EAAKL,UAAW,EAAG,I,EAG/CM,YAAc,WACZ,IAAIC,EAAS,EAAKC,OAAOC,WAErBC,EAAcH,EAAOI,YAErBC,EAAeL,EAAOM,aAzET,IACC,IAyEAH,EAAcE,GAG9B,EAAKJ,OAAOM,MAAMC,MAAlB,UAA6BzF,KAAKC,MAAMqF,GA7EzB,IACC,MA4EhB,MACA,EAAKJ,OAAOM,MAAME,OAAlB,UAA8BJ,EAA9B,QAEA,EAAKJ,OAAOM,MAAMC,MAAlB,UAA6BL,EAA7B,MACA,EAAKF,OAAOM,MAAME,OAAlB,UAA8B1F,KAAKC,MAAMmF,GAjF1B,IACC,MAgFhB,Q,EAUJO,gBAAkB,SAAAjN,GAChB,GAAK,EAAKN,MAAMwN,YAAhB,CAEA,IAAIC,EA9Fa,IA8FUC,WAAW,EAAKZ,OAAOM,MAAMC,OACpDM,EAAO,EAAKb,OAAOc,wBACnBzB,EAAIvE,KAAKC,OAAOvH,EAAEuN,QAAUF,EAAKG,MAAQL,GACzCvB,EAAItE,KAAKC,OAAOvH,EAAEyN,QAAUJ,EAAKK,KAAOP,GAC5C,EAAKzN,MAAMwN,YAAYrB,EAAGD,K,4CA9F5B,WAAU,IAAD,OACP,OACE,4BACEhL,UAAU,SACVmM,MARa,IASbC,OARc,IASdE,YAAa9Q,KAAK6Q,gBAClBU,UAAWvR,KAAKsD,MAAMiO,UACtBC,IAAK,SAAApB,GACH,EAAKA,OAASA,O,+BAMtB,WACEpQ,KAAKyR,e,gCAGP,WACEzR,KAAKyR,e,wBAGP,WACEzR,KAAKgQ,QAAUhQ,KAAKoQ,OAAOsB,WAAW,MACtC1R,KAAK4P,UAAY5P,KAAKgQ,QAAQ2B,aAC5B,EACA,EA/Be,IACC,KAmClB3R,KAAKgQ,QAAQ4B,UAAY,QAEzB5R,KAAKgQ,QAAQ6B,SAAS,EAAG,EAtCR,IACC,KAwClB7R,KAAK8R,IAAM,IAAI3Q,YAAYnB,KAAK4P,UAAUC,KAAKzO,QAE/CpB,KAAK+P,KAAO,IAAIgC,kBAAkB/R,KAAK8R,KACvC9R,KAAK0P,MAAQ,IAAIsC,YAAYhS,KAAK8R,KAGlC,IAAK,IAAIvQ,EAAI,EAAGA,EAAIvB,KAAK0P,MAAMtO,SAAUG,EACvCvB,KAAK0P,MAAMnO,GAAK,a,wBAqCpB,WACE,IAAI0Q,EAAM,IAAIC,MAEd,OADAD,EAAIvI,IAAM1J,KAAKoQ,OAAO+B,UAAU,aACzBF,M,GArFU3M,c,iBCJR8M,EAAc,SAACC,EAAOC,GACjCvM,QAAQsM,MAAMA,GACdE,IAAMC,iBAAiBH,EAAO,CAAEI,MAAOH,K,ICDpBI,E,WACnB,cAAmC,IAAD,OAApBC,EAAoB,EAApBA,iBAAoB,yBAuClCC,YAAc,SAACxB,EAAMyB,GACf,EAAKjR,OAAOkR,OAAS,GAAK,EAAKC,aACjChN,QAAQC,IAAR,kBACA,EAAKpE,OAAOoR,KAAK,EAAKD,WAAa,IAErC,EAAKnR,OAAOqR,IAAI7B,GAChB,EAAKxP,OAAOqR,IAAIJ,IA7CgB,KAgDlCK,eAAiB,SAAAtP,GACf,IAAIwN,EAAOxN,EAAEuP,aAAaC,eAAe,GACrCP,EAAQjP,EAAEuP,aAAaC,eAAe,GACtCN,EAAO1B,EAAKhQ,OAGZ,EAAKQ,OAAOkR,OAAgB,EAAPA,GAAY,EAAKH,kBACxC,EAAKA,iBAAiB,EAAK/Q,OAAOkR,OAAe,EAAPA,GAG5C,IACE,IAAIO,EAAU,EAAKzR,OAAOoR,KAAY,EAAPF,GAC/B,MAAOlP,GAKP,IAAImP,EAAa,EAAKnR,OAAOkR,OAAS,EAClCC,EAAa,GACfhN,QAAQC,IAAR,kCAAuC8M,EAAvC,iBAAoDC,EAApD,MAEF,IAAK,IAAIO,EAAI,EAAGA,EAAIR,EAAMQ,IACxBlC,EAAKkC,GAAK,EACVT,EAAMS,GAAK,EAEb,OAEF,IAAK,IAAI/R,EAAI,EAAGA,EAAIuR,EAAMvR,IACxB6P,EAAK7P,GAAK8R,EAAY,EAAJ9R,GAClBsR,EAAMtR,GAAK8R,EAAY,EAAJ9R,EAAQ,IA5E7BvB,KAAK2S,iBAAmBA,EACxB3S,KAAK+S,WAAa,KAClB/S,KAAK4B,OAAS,IAAI2R,IAA6B,EAAlBvT,KAAK+S,Y,iDAGpC,WACE,IAAKvT,OAAOgU,aACV,OAAO,MAET,IAAIC,EAAQ,IAAIjU,OAAOgU,aACnBE,EAAaD,EAAMC,WAEvB,OADAD,EAAME,QACCD,I,mBAGT,WAEOlU,OAAOgU,eAGZxT,KAAK4T,SAAW,IAAIpU,OAAOgU,aAC3BxT,KAAK6T,WAAa7T,KAAK4T,SAASE,sBAAsB,KAAM,EAAG,GAC/D9T,KAAK6T,WAAWX,eAAiBlT,KAAKkT,eACtClT,KAAK6T,WAAWE,QAAQ/T,KAAK4T,SAASI,gB,kBAGxC,WACMhU,KAAK6T,aACP7T,KAAK6T,WAAWI,WAAWjU,KAAK4T,SAASI,aACzChU,KAAK6T,WAAWX,eAAiB,KACjClT,KAAK6T,WAAa,MAEhB7T,KAAK4T,WACP5T,KAAK4T,SAASD,QAAQO,MAAM9B,GAC5BpS,KAAK4T,SAAW,U,KCyIPO,E,4MA3BbC,MAAQ,WACN,EAAKC,WAAWD,QAChB,EAAKE,SAASF,QACd,EAAKG,YAAcC,aAAY,WAC7BzO,QAAQC,IAAR,eAAoB,EAAKyO,IAAIC,aAC5B,M,EAGL7G,KAAO,WACL,EAAKwG,WAAWxG,OAChB,EAAKyG,SAASzG,OACd8G,cAAc,EAAKJ,c,4CA9IrB,WAAU,IAAD,OACP,OACE,kBAAC,EAAD,CACE/C,IAAK,SAAAoD,GACH,EAAKA,OAASA,GAEhBpJ,gBAAiB,WACf,EAAKiJ,IAAII,SAEX/D,YAAa,SAACrB,EAAGD,GACf,EAAKiF,IAAIK,WAAWrF,EAAGD,GACvB,EAAKiF,IAAIM,kBAEXxD,UAAW,WACT,EAAKkD,IAAIO,oB,+BAMjB,WAAqB,IAAD,OAElBhV,KAAKkQ,cAELlQ,KAAKsU,SAAW,IAAI5B,EAAS,CAC3BC,iBAAkB,SAACsC,EAAYC,GACzB,EAAK5R,MAAM6R,SAWfpP,QAAQC,IACN,8DAGF,EAAKqO,WAAWjJ,gBAIZ,EAAKkJ,SAAS1S,OAAOkR,OAASoC,IAChCnP,QAAQC,IAAI,iDACZ,EAAKqO,WAAWjJ,qBAKtBpL,KAAKyU,IAAM,IAAIW,MAAI,CACjBC,QAASrV,KAAK4U,OAAOrF,UACrB+F,eAAgBvP,QAAQC,IACxBuP,cAAevV,KAAKsU,SAAS1B,YAC7Bc,WAAY1T,KAAKsU,SAASkB,kBAI5BhW,OAAM,IAAUQ,KAAKyU,IAErBzU,KAAKqU,WAAa,IAAI5J,EAAW,CAC/Be,gBAAiB+G,IAAMkD,KAAKzV,KAAKyU,IAAII,OACrCxJ,aAAckH,IAAMkD,KAAKzV,KAAK4U,OAAOjF,eAIvC3P,KAAK0V,kBAAoB,IAAI9J,EAAkB,CAC7C4B,aAAcxN,KAAKyU,IAAIkB,WACvBlI,WAAYzN,KAAKyU,IAAImB,WAGvB5V,KAAK0V,kBAAkB/H,oBACvB3N,KAAK6V,eAAiB7V,KAAK0V,kBAAkB9H,eAE7C5N,KAAK8V,mBAAqB,IAAI5G,EAAmB,CAC/C1B,aAAcxN,KAAK0V,kBAAkB5J,wBACnC9L,KAAKyU,IAAIkB,YAEXlI,WAAYzN,KAAK0V,kBAAkB5J,wBACjC9L,KAAKyU,IAAImB,YAKb5V,KAAK8V,mBAAmB3G,WAExB5G,SAASC,iBAAiB,UAAWxI,KAAK8V,mBAAmBjO,eAC7DU,SAASC,iBAAiB,QAASxI,KAAK8V,mBAAmB1G,aAC3D7G,SAASC,iBACP,WACAxI,KAAK8V,mBAAmBzG,gBAG1BrP,KAAKyU,IAAIsB,QAAQ/V,KAAKsD,MAAM0S,SAC5BhW,KAAKoU,U,kCAGP,WACEpU,KAAK6N,OAGLtF,SAASY,oBACP,UACAnJ,KAAK8V,mBAAmBjO,eAE1BU,SAASY,oBAAoB,QAASnJ,KAAK8V,mBAAmB1G,aAC9D7G,SAASY,oBACP,WACAnJ,KAAK8V,mBAAmBzG,gBAI1BrP,KAAK6V,eAAehI,OAEpBrO,OAAM,SAAUmI,I,gCAGlB,SAAmB1B,GACbjG,KAAKsD,MAAM6R,SAAWlP,EAAUkP,SAC9BnV,KAAKsD,MAAM6R,OACbnV,KAAK6N,OAEL7N,KAAKoU,W,yBAwBX,WACEpU,KAAK4U,OAAO1E,kB,GAtJO5K,aCbV2Q,G,MAA0B,SAAClR,GAAuB,IACzDmR,EACJ,MAAO,CACLC,kBAAmB,SAAAvS,GACjB,IAAM6Q,EAAMjV,OAAM,IAClBoE,EAAEwS,UAGFF,EAAgBtS,EAAEhF,OAAO8R,MAAM2F,KAE/B5B,EAAIkB,WAAW5Q,EAAI,GAAIA,EAAI,IAE3BnB,EAAEhF,OAAO8R,MAAM2F,KAAO,UACtBzS,EAAEC,kBAEJyS,gBAAiB,SAAA1S,GACf,IAAM6Q,EAAMjV,OAAM,IAClBoE,EAAEwS,UACF3B,EAAImB,SAAS7Q,EAAI,GAAIA,EAAI,IAEzBnB,EAAEhF,OAAO8R,MAAM2F,KAAOH,EACtBtS,EAAEC,qBAKK0S,EAA2B,CACtCC,gBAAiB,IACjBC,OAAQR,EAAwB,CAAC,EAAGrM,aAAWI,YAC/C0M,SAAUT,EAAwB,CAAC,EAAGrM,aAAWK,cACjD0M,UAAWV,EAAwB,CAAC,EAAGrM,aAAWG,eAClD6M,SAAUX,EAAwB,CAAC,EAAGrM,aAAWC,cACjD1E,EAAG8Q,EAAwB,CAAC,EAAGrM,aAAWM,WAC1ClI,EAAGiU,EAAwB,CAAC,EAAGrM,aAAWO,WAC1CiK,MAAO6B,EAAwB,CAAC,EAAGrM,aAAWQ,eAC9CyM,OAAQZ,EAAwB,CAAC,EAAGrM,aAAWE,iBAmBpCgN,GAdHb,EAAwB,CAAC,EAAGrM,aAAWI,YACrCiM,EAAwB,CAAC,EAAGrM,aAAWK,cACtCgM,EAAwB,CAAC,EAAGrM,aAAWG,eACxCkM,EAAwB,CAAC,EAAGrM,aAAWC,cAC9CoM,EAAwB,CAAC,EAAGrM,aAAWM,WACvC+L,EAAwB,CAAC,EAAGrM,aAAWO,WACnC8L,EAAwB,CAAC,EAAGrM,aAAWQ,eACtC6L,EAAwB,CAAC,EAAGrM,aAAWE,gBAOpB,SAAC,GAUvB,IATL0M,EASI,EATJA,gBACAC,EAQI,EARJA,OACAC,EAOI,EAPJA,SACAE,EAMI,EANJA,SACAD,EAKI,EALJA,UACAxR,EAII,EAJJA,EACAnD,EAGI,EAHJA,EACA6U,EAEI,EAFJA,OACAzC,EACI,EADJA,MAEA,OACE,yBAAK5P,UAAU,iBACb,yBACEuS,QAAQ,MACR5K,GAAG,OACH6K,MAAM,6BACNrG,MAAK,UAAK6F,EAAL,KACL5F,OAAM,UAAK4F,EAAL,KACNS,QAAQ,iCACRC,iBAAiB,sCAEjB,gCACE,2BACE,2BACE,0BACE/K,GAAG,uBACHsD,EAAE,SACFD,EAAE,UACF6G,KAAK,UACL1F,MAAM,UACNC,OAAO,YAET,0BACEzE,GAAG,cACHkK,KAAK,UACLc,EAAE,sMAEJ,0BACEhL,GAAG,eACHkK,KAAK,UACLc,EAAE,uMAEJ,0BACEhL,GAAG,cACHkK,KAAK,UACLc,EAAE,uMAEJ,0BACEhL,GAAG,mBACHkK,KAAK,UACLc,EAAE,iQAEJ,0BACEhL,GAAG,cACHiL,OAAO,UACPC,YAAY,SACZC,cAAc,QACdH,EAAE,mXAEJ,0BACEhL,GAAG,OACHkK,KAAK,UACLc,EAAE,yWAEJ,0BACEhL,GAAG,iBACHkK,KAAK,UACL5G,EAAE,KACFD,EAAE,MACFoB,OAAO,KACPD,MAAM,KACN4G,cAAa,OAAEd,QAAF,IAAEA,OAAF,EAAEA,EAAQH,gBACvBkB,WAAU,OAAEf,QAAF,IAAEA,OAAF,EAAEA,EAAQH,gBACpBmB,aAAY,OAAEhB,QAAF,IAAEA,OAAF,EAAEA,EAAQN,oBAExB,0BACEhK,GAAG,mBACHkK,KAAK,UACL5G,EAAE,KACFD,EAAE,MACFoB,OAAO,KACPD,MAAM,KACN4G,cAAa,OAAEb,QAAF,IAAEA,OAAF,EAAEA,EAAUJ,gBACzBkB,WAAU,OAAEd,QAAF,IAAEA,OAAF,EAAEA,EAAUJ,gBACtBmB,aAAY,OAAEf,QAAF,IAAEA,OAAF,EAAEA,EAAUP,oBAE1B,0BACEhK,GAAG,mBACHkK,KAAK,UACL5G,EAAE,KACFD,EAAE,MACFoB,OAAO,KACPD,MAAM,KACN8G,aAAY,OAAEb,QAAF,IAAEA,OAAF,EAAEA,EAAUT,kBACxBoB,cAAa,OAAEX,QAAF,IAAEA,OAAF,EAAEA,EAAUN,gBACzBkB,WAAU,OAAEZ,QAAF,IAAEA,OAAF,EAAEA,EAAUN,kBAExB,0BACEnK,GAAG,oBACHkK,KAAK,UACL5G,EAAE,MACFD,EAAE,MACFoB,OAAO,KACPD,MAAM,KACN4G,cAAa,OAAEZ,QAAF,IAAEA,OAAF,EAAEA,EAAWL,gBAC1BkB,WAAU,OAAEb,QAAF,IAAEA,OAAF,EAAEA,EAAWL,gBACvBmB,aAAY,OAAEd,QAAF,IAAEA,OAAF,EAAEA,EAAWR,oBAE3B,uBACEhK,GAAG,SACHuL,UAAU,yDAEV,0BACEvL,GAAG,gBACHkK,KAAK,UACLc,EAAE,uMAEJ,0BACEhL,GAAG,UACHkK,KAAK,UACLc,EAAE,0HACFI,cAAa,OAAEvV,QAAF,IAAEA,OAAF,EAAEA,EAAGsU,gBAClBkB,WAAU,OAAExV,QAAF,IAAEA,OAAF,EAAEA,EAAGsU,gBACfmB,aAAY,OAAEzV,QAAF,IAAEA,OAAF,EAAEA,EAAGmU,qBAGrB,uBACEhK,GAAG,SACHuL,UAAU,yDAEV,0BACEvL,GAAG,gBACHkK,KAAK,UACLc,EAAE,uMAIJ,0BACEhL,GAAG,UACHkK,KAAK,UACLc,EAAE,qJAEFI,cAAa,OAAEpS,QAAF,IAAEA,OAAF,EAAEA,EAAGmR,gBAClBkB,WAAU,OAAErS,QAAF,IAAEA,OAAF,EAAEA,EAAGmR,gBACfmB,aAAY,OAAEtS,QAAF,IAAEA,OAAF,EAAEA,EAAGgR,kBACjBrF,YAAW,OAAE3L,QAAF,IAAEA,OAAF,EAAEA,EAAGgR,kBAChB5E,UAAS,OAAEpM,QAAF,IAAEA,OAAF,EAAEA,EAAGmR,mBAGlB,0BACEnK,GAAG,4BACHkK,KAAK,UACLc,EAAE,wMAIJ,0BACEhL,GAAG,8BACHkK,KAAK,UACLc,EAAE,8MAIJ,0BACEhL,GAAG,oCACHkK,KAAK,OACLe,OAAO,UACPC,YAAY,SACZC,cAAc,QACdH,EAAE,qMAIJ,0BACEhL,GAAG,WACHgL,EAAE,4KAGJ,0BACEhL,GAAG,WACHgL,EAAE,uLAGJ,uBAAGhL,GAAG,gBACJ,0BACEA,GAAG,WACHkK,KAAK,UACLc,EAAE,4LAGJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,kDAEJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,+GAGJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,uPAIJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,mDAEJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,4cAMJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,ydAMJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,4PAIJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,sUAKJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,oiBAOJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,grBASN,uBAAGhL,GAAG,cACJ,0BACEA,GAAG,WACHkK,KAAK,UACLc,EAAE,yNAIJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,sKAGJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,iIAGJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,sKAGJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,+MAIJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,8EAGN,uBAAGhL,GAAG,aACJ,0BACEA,GAAG,WACHkK,KAAK,UACLc,EAAE,0NAIJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,4EAEJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,2PAIJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,2PAIJ,0BACEhL,GAAG,WACHkK,KAAK,UACLc,EAAE,8EAGN,uBAAGhL,GAAG,SACJ,0BACEA,GAAG,WACHkK,KAAK,UACLc,EAAE,2QAKN,uBAAGhL,GAAG,SACJ,0BACEA,GAAG,WACHkK,KAAK,UACLc,EAAE,8PAKN,0BACEhL,GAAG,gBACHiL,OAAO,UACPC,YAAY,MACZF,EAAE,2GAEFI,cAAa,OAAEX,QAAF,IAAEA,OAAF,EAAEA,EAAUN,gBACzBkB,WAAU,OAAEZ,QAAF,IAAEA,OAAF,EAAEA,EAAUN,gBACtBmB,aAAY,OAAEb,QAAF,IAAEA,OAAF,EAAEA,EAAUT,oBAE1B,0BACEhK,GAAG,iBACHiL,OAAO,UACPC,YAAY,MACZF,EAAE,6GAEFI,cAAa,OAAEZ,QAAF,IAAEA,OAAF,EAAEA,EAAWL,gBAC1BkB,WAAU,OAAEb,QAAF,IAAEA,OAAF,EAAEA,EAAWL,gBACvBmB,aAAY,OAAEd,QAAF,IAAEA,OAAF,EAAEA,EAAWR,oBAE3B,0BACEhK,GAAG,cACHiL,OAAO,UACPC,YAAY,MACZF,EAAE,6GAEFI,cAAa,OAAEd,QAAF,IAAEA,OAAF,EAAEA,EAAQH,gBACvBkB,WAAU,OAAEf,QAAF,IAAEA,OAAF,EAAEA,EAAQH,gBACpBmB,aAAY,OAAEhB,QAAF,IAAEA,OAAF,EAAEA,EAAQN,oBAExB,0BACEhK,GAAG,gBACHiL,OAAO,UACPC,YAAY,MACZF,EAAE,6GAEFI,cAAa,OAAEb,QAAF,IAAEA,OAAF,EAAEA,EAAUJ,gBACzBkB,WAAU,OAAEd,QAAF,IAAEA,OAAF,EAAEA,EAAUJ,gBACtBmB,aAAY,OAAEf,QAAF,IAAEA,OAAF,EAAEA,EAAUP,oBAE1B,0BACEhK,GAAG,aACHkK,KAAK,OACLe,OAAO,UACPC,YAAY,SACZF,EAAE,iPAKJ,0BACEhL,GAAG,oBACHkK,KAAK,UACLc,EAAE,6KAEFI,cAAa,OAAEV,QAAF,IAAEA,OAAF,EAAEA,EAAQP,gBACvBkB,WAAU,OAAEX,QAAF,IAAEA,OAAF,EAAEA,EAAQP,gBACpBmB,aAAY,OAAEZ,QAAF,IAAEA,OAAF,EAAEA,EAAQV,oBAExB,0BACEhK,GAAG,mBACHkK,KAAK,UACLc,EAAE,uLAEFI,cAAa,OAAEnD,QAAF,IAAEA,OAAF,EAAEA,EAAOkC,gBACtBkB,WAAU,OAAEpD,QAAF,IAAEA,OAAF,EAAEA,EAAOkC,gBACnBmB,aAAY,OAAErD,QAAF,IAAEA,OAAF,EAAEA,EAAO+B,kBACrB5E,UAAS,OAAE6C,QAAF,IAAEA,OAAF,EAAEA,EAAOkC,gBAClBxF,YAAW,OAAEsD,QAAF,IAAEA,OAAF,EAAEA,EAAO+B,2BCpRrBwB,G,wDAhMb,WAAYrU,GAAQ,IAAD,8BACjB,cAAMA,IAuHRrD,KAAO,WACL,GAAI,EAAKqD,MAAMsU,MAAMC,OAAOC,KAAM,CAChC,IAAMA,EAAO,EAAKxU,MAAMsU,MAAMC,OAAOC,KAC/BC,EAAa,UAAUC,KAAKF,GAC5BG,EAAUH,EAAKlY,MAAM,KAAK,GAC1BsY,EAAUH,EACZlY,EAAWC,iBAAiBmY,GAC5B3Z,EAAOC,KAAKuZ,GAEhB,IAAKI,EAEH,YADA,EAAKzU,SAAS,CAAE4O,MAAM,gBAAD,OAAkByF,KAIzC,GAAIC,EAAY,CACd,EAAKtU,SAAS,CAAE0U,QAASD,EAAQzZ,OACjC,IAAM2Z,EAAe9V,aAAaC,QAAQ,QAAU0V,GACpD,EAAKI,aAAaD,QAElB,EAAK3U,SAAS,CAAE0U,QAASD,EAAQxZ,cACjC,EAAK4Z,eJtJN,SAAoBC,EAAMxM,EAAUyM,GACzC,IAAIC,EAAM,IAAIC,eAsBd,OArBAD,EAAIE,KAAK,MAAOJ,GAChBE,EAAIG,iBAAiB,sCACrBH,EAAI9X,OAAS,WACX,GAAoB,MAAhBX,KAAK6Y,OAAgB,CACvB,GAAIJ,EAAIK,aAAalB,MAAM,qBAEzB,OAAO7L,EAAS,IAAIgN,MAAM,mBAG5BhN,EAAS,KAAM/L,KAAK8Y,mBACK,IAAhB9Y,KAAK6Y,QAGd9M,EAAS,IAAIgN,MAAMN,EAAIO,cAG3BP,EAAIQ,QAAU,WACZlN,EAAS,IAAIgN,MAAMN,EAAIO,cAEzBP,EAAIS,WAAaV,EACjBC,EAAIU,OACGV,EI+HqBW,CACpBlB,EAAQpZ,KACR,SAACua,EAAKxJ,GACAwJ,EACF,EAAK5V,SAAS,CAAE4O,MAAM,sBAAD,OAAwBgH,EAAIC,WAEjD,EAAKjB,aAAaxI,KAGtB,EAAK2I,qBAGJ,GAAI,EAAKlV,MAAM7D,SAAS8E,OAAS,EAAKjB,MAAM7D,SAAS8E,MAAMlE,KAAM,CACtE,IAAII,EAAS,IAAIC,WACjBD,EAAOG,mBAAmB,EAAK0C,MAAM7D,SAAS8E,MAAMlE,MACpDI,EAAOE,OAAS,SAAAiD,GACd,EAAK0U,eAAiB,KACtB,EAAKD,aAAa5X,EAAOQ,cAG3B,EAAKwC,SAAS,CAAE4O,MAAO,qBAhKR,EAoKnBmG,eAAiB,SAAA5U,GACXA,EAAE2V,kBACJ,EAAK9V,SAAS,CAAE+V,cAAgB5V,EAAE6V,OAAS7V,EAAE8V,MAAS,OAtKvC,EA0KnBrB,aAAe,SAAAxI,GACb,EAAKpM,SAAS,CAAEgI,SAAS,EAAMkO,SAAS,EAAO3D,QAASnG,KA3KvC,EA8KnB+J,kBAAoB,WAClB,EAAKnW,SAAS,CAAE0R,QAAS,EAAK5Q,MAAM4Q,UA/KnB,EAkLnB0E,OAAS,WACP,IAAIC,EAAe9I,WAAWxR,OAAOua,iBAAiB,EAAKC,QAAQpJ,QACnE,EAAKqJ,gBAAgBvJ,MAAME,OAA3B,UAAuCpR,OAAO0a,YAC5CJ,EADF,MAEI,EAAKK,UACP,EAAKA,SAASjK,eAvLC,EA2LnBkK,oBAAsB,WACpB,EAAK3W,SAAS,CAAE4W,mBAAoB,EAAK9V,MAAM8V,qBA1L/C,EAAK9V,MAAQ,CACX4T,QAAS,KACTnC,QAAS,KACTvK,SAAS,EACT0J,QAAQ,EACRkF,mBAAmB,EACnBV,SAAS,EACTH,cAAe,EACfnH,MAAO,MAVQ,E,0CAcnB,WAAU,IAAD,OACP,OACE,yBAAK7N,UAAU,WACb,yBACEA,UAAU,uBACVgN,IAAK,SAAA8I,GACH,EAAKN,OAASM,IAGhB,wBAAI9V,UAAU,aAAakM,MAAO,CAAEC,MAAO,UACzC,wBAAInM,UAAU,WACZ,kBAAC,IAAD,CAAMQ,GAAG,IAAIR,UAAU,YAAvB,iBAKJ,wBAAIA,UAAU,8BACZ,wBAAIA,UAAU,WACZ,0BAAMA,UAAU,oBAAoBxE,KAAKuE,MAAM4T,WAGnD,wBAAI3T,UAAU,aAAakM,MAAO,CAAEC,MAAO,UACzC,wBAAInM,UAAU,WACZ,kBAAC8F,EAAA,EAAD,CACEC,SAAO,EACPC,MAAM,UACNpF,QAASpF,KAAKoa,oBACd5V,UAAU,QAJZ,YAQA,kBAAC8F,EAAA,EAAD,CACEC,SAAO,EACPC,MAAM,UACNpF,QAASpF,KAAK4Z,kBACdW,UAAWva,KAAKuE,MAAMkH,SAErBzL,KAAKuE,MAAM4Q,OAAS,SAAW,YAMvCnV,KAAKuE,MAAM8N,MACVrS,KAAKuE,MAAM8N,MAEX,yBACE7N,UAAU,mBACVgN,IAAK,SAAA8I,GACH,EAAKL,gBAAkBK,IAGxBta,KAAKuE,MAAMoV,QACV,kBAACa,EAAA,EAAD,CACEvT,MAAOjH,KAAKuE,MAAMiV,cAClB9I,MAAO,CACL+J,SAAU,WACV9J,MAAO,MACPS,KAAM,MACNE,IAAK,SAGPtR,KAAKuE,MAAMyR,QACb,kBAAC,EAAD,CACEA,QAAShW,KAAKuE,MAAMyR,QACpBb,OAAQnV,KAAKuE,MAAM4Q,OACnB3D,IAAK,SAAA2I,GACH,EAAKA,SAAWA,KAGlB,KAGHna,KAAKuE,MAAM8V,mBACV,kBAAC,EAAD,CACEhR,OAAQrJ,KAAKuE,MAAM8V,kBACnB/Q,OAAQtJ,KAAKoa,oBACbvV,KAAM7E,KAAKma,SAASrE,mBAAmBjR,KACvCsD,QAASnI,KAAKma,SAASrE,mBAAmB3N,QAC1CG,aAActI,KAAKma,SAASzE,kBAAkBpN,aAC9ChC,cAAetG,KAAKma,SAASzE,kBAAkBpP,cAC/C8B,iBACEpI,KAAKma,SAASzE,kBAAkBtN,mBAItC,kBAAC,EAAkBmO,O,+BAO7B,WACE/W,OAAOgJ,iBAAiB,SAAUxI,KAAK6Z,QACvC7Z,KAAK6Z,SACL7Z,KAAKC,S,kCAGP,WACET,OAAO2J,oBAAoB,SAAUnJ,KAAK6Z,QACtC7Z,KAAKsY,gBACPtY,KAAKsY,eAAeoC,Y,GArHJpV,cCqCPqV,G,wDA3Cb,WAAYrX,GAAQ,IAAD,8BACjB,cAAMA,IAoCRsX,eAAiB,YAAmB,IAAhBnb,EAAe,EAAfA,SAElB,OADAob,IAAgBC,SAASrb,EAAS6E,UAC3B,MArCP,EAAKC,MAAQ,CAAE8N,MAAO,MAClB/T,EAAOY,uBACT2b,IAAgBE,WAAWzc,EAAOY,uBAJnB,E,0CAQnB,WACE,OAAIc,KAAKuE,MAAM8N,MAEX,yBAAK7N,UAAU,kBACb,yBAAKA,UAAU,8BACb,yBAAKA,UAAU,YAAf,wEAQN,kBAAC,IAAD,CAAewW,SAAU1c,EAAOiB,YAC9B,yBAAKiF,UAAU,OACb,kBAAC,IAAD,CAAOyW,OAAK,EAAC1C,KAAK,IAAI2C,UAAW7X,IACjC,kBAAC,IAAD,CAAO4X,OAAK,EAAC1C,KAAK,OAAO2C,UAAWvD,IACpC,kBAAC,IAAD,CAAOsD,OAAK,EAAC1C,KAAK,aAAa2C,UAAWvD,IAC1C,kBAAC,IAAD,CAAOY,KAAK,IAAI4C,OAAQnb,KAAK4a,qB,+BAMrC,SAAkBvI,EAAOC,GACvBtS,KAAKyD,SAAS,CAAE4O,UAChBD,EAAYC,EAAOC,O,GAnCLhN,c,MCFdhH,EAAOe,YACTkT,IAAMjU,OAAOA,EAAOe,YAAY+b,UAGlC7I,IAAMvC,SAAQ,WACZqL,IAASF,OAAO,kBAAC,EAAD,MAAS5S,SAAS+S,eAAe,c","file":"static/js/main.7e31773d.chunk.js","sourcesContent":["import React from \"react\";\n\nconst config = {\n  ROMS: {\n    owlia: {\n      name: \"The Legends of Owlia\",\n      description: (\n        <span>\n          <a\n            href=\"http://www.gradualgames.com/p/the-legends-of-owlia_1.html\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Owlia by Gradual Games\n          </a>{\" \"}\n          /{\" \"}\n          <a\n            href=\"http://www.infiniteneslives.com/owlia.php\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Buy the cartridge\n          </a>\n        </span>\n      ),\n      url: \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/owlia.nes\"\n    },\n    nomolos: {\n      name: \"Nomolos: Storming the Catsle\",\n      description: (\n        <span>\n          <a\n            href=\"http://www.gradualgames.com/p/nomolos-storming-catsle.html\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Monolos by Gradual Games\n          </a>{\" \"}\n          /{\" \"}\n          <a\n            href=\"http://www.infiniteneslives.com/nomolos.php\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Buy the cartridge\n          </a>\n        </span>\n      ),\n      url: \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/nomolos.nes\"\n    },\n    croom: {\n      name: \"Concentration Room\",\n      description: (\n        <span>\n          <a\n            href=\"http://www.pineight.com/croom/README\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Concentration Room\n          </a>{\" \"}\n          by Damian Yerrick\n        </span>\n      ),\n      url:\n        \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/croom/croom.nes\"\n    },\n    lj65: {\n      name: \"LJ65\",\n      description: (\n        <span>\n          <a\n            href=\"http://harddrop.com/wiki/LJ65\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Concentration Room\n          </a>{\" \"}\n          by Damian Yerrick\n        </span>\n      ),\n      url: \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/lj65/lj65.nes\"\n    }\n  },\n  GOOGLE_ANALYTICS_CODE: process.env.REACT_APP_GOOGLE_ANALYTICS_CODE,\n  SENTRY_URI: process.env.REACT_APP_SENTRY_URI,\n  BASENAME: () => {\n    const url = window.location.href;\n    // we're on github pages, which means we have a subpath\n    if (url.includes(\"github.io\")) {\n      const parts = url.split(\"/\");\n      // [\"https:/\",\"/\",\"...github.io/\",$money]\n      return `/${parts[3]}`;\n    }\n\n    // default case, we don't have a base path\n    // good for localhost\n    return \"\"\n  }\n};\n\nexport default config;\n","const pFileReader = function(file) {\n  return new Promise((resolve, reject) => {\n    var reader = new FileReader();\n    reader.onload = resolve;\n    reader.readAsBinaryString(file);\n  });\n};\n\nconst hashFile = function(byteString) {\n  const asHex = buffer => {\n    return Array.from(new Uint8Array(buffer))\n      .map(b => b.toString(16).padStart(2, \"0\"))\n      .join(\"\");\n  };\n\n  const ab = new ArrayBuffer(byteString.length);\n  var ia = new Uint8Array(ab);\n\n  for (var i = 0; i < byteString.length; i++) {\n    ia[i] = byteString.charCodeAt(i);\n  }\n\n  return crypto.subtle.digest(\"SHA-1\", ab).then(asHex);\n};\n\nconst RomLibrary = {\n  getRomInfoByHash: function(hash) {\n    return this.load().find(rom => rom.hash === hash);\n  },\n  save: function(file) {\n    return pFileReader(file)\n      .then(function(readFile) {\n        const byteString = readFile.target.result;\n        return hashFile(byteString).then(hash => {\n          return { hash, byteString };\n        });\n      })\n      .then(({ hash, byteString }) => {\n        const savedRomInfo = localStorage.getItem(\"savedRomInfo\");\n        const existingLibrary = savedRomInfo ? JSON.parse(savedRomInfo) : [];\n\n        const rom = {\n          name: file.name,\n          hash: hash,\n          added: Date.now()\n        };\n\n        const newRomInfo = JSON.stringify(existingLibrary.concat([rom]));\n\n        localStorage.setItem(\"savedRomInfo\", newRomInfo);\n        localStorage.setItem(\"blob-\" + hash, byteString);\n\n        return rom;\n      });\n  },\n  load: function() {\n    const localData = localStorage.getItem(\"savedRomInfo\");\n    if (!localData) return [];\n    const savedRomInfo = JSON.parse(localStorage.getItem(\"savedRomInfo\"));\n    return savedRomInfo || [];\n  },\n  delete: function(hash) {\n    const existingLibrary = this.load();\n    localStorage.removeItem(\"blob-\" + hash);\n    localStorage.setItem(\n      \"savedRomInfo\",\n      JSON.stringify(existingLibrary.filter(rom => rom.hash !== hash))\n    );\n  }\n};\n\nexport default RomLibrary;\n","import React, { Component } from \"react\";\nimport \"./ListPage.css\";\nimport { ListGroup } from \"reactstrap\";\nimport { Link } from \"react-router-dom\";\nimport config from \"./config\";\n\nimport RomLibrary from \"./RomLibrary\";\n\nconst rootRunPath = \"/run\";\nconst rootRunPathLocal = \"/local-\";\n\nclass ListPage extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      romLibrary: RomLibrary.load()\n    };\n  }\n  render() {\n    return (\n      <div\n        className=\"drop-zone\"\n        onDragOver={this.handleDragOver}\n        onDrop={this.handleDrop}\n      >\n        <div className=\"container ListPage py-4\">\n          <div className=\"row justify-content-center\">\n            <div className=\"col-md-8\">\n              <header className=\"mb-4\">\n                <h1 className=\"mb-3\">JSNES</h1>\n                <p>\n                  A JavaScript NES emulator.{\" \"}\n                  <a href=\"https://github.com/bfirsh/jsnes\">\n                    Source on GitHub.\n                  </a>\n                </p>\n              </header>\n\n              <ListGroup className=\"mb-4\">\n                {Object.keys(config.ROMS)\n                  .sort()\n                  .map(key => (\n                    <Link\n                      key={key}\n                      to={rootRunPath + \"/\" +  encodeURIComponent(key)}\n                      className=\"list-group-item\"\n                    >\n                      {config.ROMS[key][\"name\"]}\n                      <span className=\"float-right\">&rsaquo;</span>\n                    </Link>\n                  ))}\n              </ListGroup>\n\n              <p>\n                Or, drag and drop a ROM file onto the page to play it. (Google\n                may help you find them.)\n              </p>\n\n              {this.state.romLibrary.length > 0 ? (\n                <div>\n                  <p>Previously played:</p>\n\n                  <ListGroup className=\"mb-4\">\n                    {this.state.romLibrary\n                      .sort((a, b) => new Date(b.added) - new Date(a.added))\n                      .map(rom => (\n                        <Link\n                          key={rom.hash}\n                          to={rootRunPathLocal + rom.hash}\n                          className=\"list-group-item\"\n                        >\n                          {rom.name}\n                          <span\n                            onClick={e => {\n                              e.preventDefault();\n                              this.deleteRom(rom.hash);\n                            }}\n                            className=\"delete\"\n                            title=\"Delete\"\n                          >\n                            &times;\n                          </span>\n                          <span className=\"float-right\">&rsaquo;</span>\n                        </Link>\n                      ))}\n                  </ListGroup>\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  deleteRom = hash => {\n    RomLibrary.delete(hash);\n    this.updateLibrary();\n  };\n\n  updateLibrary = () => {\n    this.setState({ romLibrary: RomLibrary.load() });\n  };\n\n  handleDragOver = e => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = \"copy\";\n  };\n\n  handleDrop = e => {\n    e.preventDefault();\n\n    const file = e.dataTransfer.items\n      ? e.dataTransfer.items[0].getAsFile()\n      : e.dataTransfer.files[0];\n\n    RomLibrary.save(file).then(rom => {\n      this.updateLibrary();\n      this.props.history.push({ pathname:  + rom.hash });\n    });\n  };\n}\n\nexport default ListPage;\n","import React, { Component } from \"react\";\n\nclass ControlMapperRow extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      playerOneButton: \"\",\n      playerTwoButton: \"\",\n      waitingForKey: 0\n    };\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentDidMount() {\n    var keys = this.props.keys;\n    var button = this.props.button;\n    var playerButtons = [];\n    for (var key in keys) {\n      if (keys[key][0] === 1 && keys[key][1] === button) {\n        playerButtons[0] = keys[key][2];\n        console.log(playerButtons[0]);\n      } else if (keys[key][0] === 2 && keys[key][1] === button) {\n        playerButtons[1] = keys[key][2];\n      }\n    }\n    this.setState({\n      playerOneButton: playerButtons[0],\n      playerTwoButton: playerButtons[1]\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    var keys = this.props.keys;\n    var button = this.props.button;\n    var playerButtons = [];\n    var gamepadButton;\n    var newButton;\n\n    for (var key in keys) {\n      if (keys[key][0] === 1 && keys[key][1] === button) {\n        playerButtons[0] = keys[key][2];\n        console.log(playerButtons[0]);\n      } else if (keys[key][0] === 2 && keys[key][1] === button) {\n        playerButtons[1] = keys[key][2];\n      }\n    }\n\n    var searchButton = (gamepadConfig, buttonId) => {\n      return gamepadConfig.buttons.filter(b => b.buttonId === buttonId)[0];\n    };\n\n    var searchNewButton = (prevGamepadConfig, gamepadConfig) => {\n      return gamepadConfig.buttons.filter(b => {\n        return (\n          !prevGamepadConfig ||\n          !prevGamepadConfig.buttons.some(b2 => b2.buttonId === b.buttonId)\n        );\n      })[0];\n    };\n\n    var waitingForKey = 0;\n    var waitingForKeyPlayer = 0;\n\n    var gamepadButtonName = gamepadButton => {\n      if (gamepadButton.type === \"button\") return \"Btn-\" + gamepadButton.code;\n      if (gamepadButton.type === \"axis\")\n        return \"Axis-\" + gamepadButton.code + \" \" + gamepadButton.value;\n    };\n\n    if (this.props.gamepadConfig && this.props.gamepadConfig.playerGamepadId) {\n      const playerGamepadId = this.props.gamepadConfig.playerGamepadId;\n      if (playerGamepadId[0]) {\n        playerButtons[0] = \"\";\n        gamepadButton = searchButton(\n          this.props.gamepadConfig.configs[playerGamepadId[0]],\n          button\n        );\n        newButton = searchNewButton(\n          prevProps.gamepadConfig.configs[playerGamepadId[0]],\n          this.props.gamepadConfig.configs[playerGamepadId[0]]\n        );\n        if (gamepadButton) {\n          playerButtons[0] = gamepadButtonName(gamepadButton);\n        } else {\n          if (newButton && newButton.buttonId === this.props.prevButton) {\n            if (!waitingForKey) {\n              waitingForKey = 1;\n              waitingForKeyPlayer = 1;\n            }\n          }\n        }\n      }\n\n      if (playerGamepadId[1]) {\n        playerButtons[1] = \"\";\n        gamepadButton = searchButton(\n          this.props.gamepadConfig.configs[playerGamepadId[1]],\n          button\n        );\n        newButton = searchNewButton(\n          prevProps.gamepadConfig.configs[playerGamepadId[1]],\n          this.props.gamepadConfig.configs[playerGamepadId[1]]\n        );\n        if (gamepadButton) {\n          playerButtons[1] = gamepadButtonName(gamepadButton);\n        } else {\n          if (newButton && newButton.buttonId === this.props.prevButton) {\n            if (!waitingForKey) {\n              waitingForKey = 2;\n              waitingForKeyPlayer = 2;\n            }\n          }\n        }\n      }\n    }\n\n    var newState = {};\n\n    if (waitingForKey) {\n      this.props.handleClick([waitingForKeyPlayer, this.props.button]);\n    }\n    // Prevent setState being called repeatedly\n    if (\n      prevState.playerOneButton !== playerButtons[0] ||\n      prevState.playerTwoButton !== playerButtons[1]\n    ) {\n      newState.playerOneButton = playerButtons[0];\n      newState.playerTwoButton = playerButtons[1];\n    }\n\n    if (waitingForKey) {\n      newState.waitingForKey = waitingForKey;\n    } else if (prevState.waitingForKey === 1) {\n      if (this.props.currentPromptButton !== this.props.button) {\n        newState.waitingForKey = 0;\n      }\n    } else if (prevState.waitingForKey === 2) {\n      if (this.props.currentPromptButton !== this.props.button) {\n        newState.waitingForKey = 0;\n      }\n    }\n\n    if (Object.keys(newState).length > 0) {\n      this.setState(newState);\n    }\n  }\n\n  handleClick(player) {\n    this.props.handleClick([player, this.props.button]);\n    this.setState({\n      waitingForKey: player\n    });\n  }\n\n  render() {\n    const waitingText = \"Press key or button...\";\n    return (\n      <tr>\n        <td>{this.props.buttonName}</td>\n        <td onClick={() => this.handleClick(1)}>\n          {this.state.waitingForKey === 1\n            ? waitingText\n            : this.state.playerOneButton}\n        </td>\n        <td onClick={() => this.handleClick(2)}>\n          {this.state.waitingForKey === 2\n            ? waitingText\n            : this.state.playerTwoButton}\n        </td>\n      </tr>\n    );\n  }\n}\n\nexport default ControlMapperRow;\n","import React, { Component } from \"react\";\nimport {\n  Button,\n  Modal,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n  Table\n} from \"reactstrap\";\nimport { Controller } from \"jsnes\";\nimport ControlMapperRow from \"./ControlMapperRow\";\n\nconst GAMEPAD_ICON = \"../img/nes_controller.png\";\nconst KEYBOARD_ICON = \"../img/keyboard.png\";\n\nclass ControlsModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      gamepadConfig: props.gamepadConfig,\n      keys: props.keys,\n      button: undefined,\n      modified: false\n    };\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleGamepadButtonDown = this.handleGamepadButtonDown.bind(this);\n    this.listenForKey = this.listenForKey.bind(this);\n\n    this.state.gamepadConfig = this.state.gamepadConfig || {};\n    this.state.gamepadConfig.playerGamepadId = this.state.gamepadConfig\n      .playerGamepadId || [null, null];\n    this.state.gamepadConfig.configs = this.state.gamepadConfig.configs || {};\n\n    this.state.controllerIcon = this.state.gamepadConfig.playerGamepadId.map(\n      gamepadId => (gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON)\n    );\n    this.state.controllerIconAlt = this.state.gamepadConfig.playerGamepadId.map(\n      gamepadId => (gamepadId ? \"gamepad\" : \"keyboard\")\n    );\n    this.state.currentPromptButton = -1;\n  }\n\n  componentWillUnmount() {\n    if (this.state.modified) {\n      this.props.setKeys(this.state.keys);\n      this.props.setGamepadConfig(this.state.gamepadConfig);\n    }\n    this.removeKeyListener();\n  }\n\n  listenForKey(button) {\n    var currentPromptButton = button[1];\n\n    this.removeKeyListener();\n    this.setState({ button, currentPromptButton });\n    this.props.promptButton(this.handleGamepadButtonDown);\n    document.addEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  handleGamepadButtonDown(buttonInfo) {\n    this.removeKeyListener();\n\n    var button = this.state.button;\n\n    const playerId = button[0];\n    const buttonId = button[1];\n\n    const gamepadId = buttonInfo.gamepadId;\n    const gamepadConfig = this.state.gamepadConfig;\n\n    // link player to gamepad\n    const playerGamepadId = gamepadConfig.playerGamepadId.slice(0);\n    const newConfig = {};\n\n    playerGamepadId[playerId - 1] = gamepadId;\n\n    const rejectButtonId = b => {\n      return b.buttonId !== buttonId;\n    };\n\n    const newButton = {\n      code: buttonInfo.code,\n      type: buttonInfo.type,\n      buttonId: buttonId,\n      value: buttonInfo.value\n    };\n    newConfig[gamepadId] = {\n      buttons: (gamepadConfig.configs[gamepadId] || { buttons: [] }).buttons\n        .filter(rejectButtonId)\n        .concat([newButton])\n    };\n\n    const configs = Object.assign({}, gamepadConfig.configs, newConfig);\n\n    this.setState({\n      gamepadConfig: {\n        configs: configs,\n        playerGamepadId: playerGamepadId\n      },\n      currentPromptButton: -1,\n      controllerIcon: playerGamepadId.map(gamepadId =>\n        gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON\n      ),\n      modified: true\n    });\n  }\n\n  handleKeyDown(event) {\n    this.removeKeyListener();\n\n    var button = this.state.button;\n    var keys = this.state.keys;\n    var newKeys = {};\n    for (var key in keys) {\n      if (keys[key][0] !== button[0] || keys[key][1] !== button[1]) {\n        newKeys[key] = keys[key];\n      }\n    }\n\n    const playerGamepadId = this.state.gamepadConfig.playerGamepadId.slice(0);\n    const playerId = button[0];\n    playerGamepadId[playerId - 1] = null;\n\n    this.setState({\n      keys: {\n        ...newKeys,\n        [event.keyCode]: [\n          ...button.slice(0, 2),\n          event.key.length > 1 ? event.key : String(event.key).toUpperCase()\n        ]\n      },\n      button: undefined,\n      gamepadConfig: {\n        configs: this.state.gamepadConfig.configs,\n        playerGamepadId: playerGamepadId\n      },\n      currentPromptButton: -1,\n      controllerIcon: playerGamepadId.map(gamepadId =>\n        gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON\n      ),\n      controllerIconAlt: playerGamepadId.map(gamepadId =>\n        gamepadId ? \"gamepad\" : \"keyboard\"\n      ),\n      modified: true\n    });\n  }\n\n  removeKeyListener() {\n    this.props.promptButton(null);\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  render() {\n    return (\n      <Modal\n        isOpen={this.props.isOpen}\n        toggle={this.props.toggle}\n        className=\"ControlsModal\"\n      >\n        <ModalHeader toggle={this.props.toggle}>Controls</ModalHeader>\n        <ModalBody>\n          <Table>\n            <thead>\n              <tr>\n                <th>Button</th>\n                <th>\n                  Player 1\n                  <img\n                    className=\"controller-icon\"\n                    src={this.state.controllerIcon[0]}\n                    alt={this.state.controllerIconAlt[0]}\n                  />\n                </th>\n                <th>\n                  Player 2\n                  <img\n                    className=\"controller-icon\"\n                    src={this.state.controllerIcon[1]}\n                    alt={this.state.controllerIconAlt[1]}\n                  />\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              <ControlMapperRow\n                buttonName=\"Left\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_LEFT}\n                prevButton={Controller.BUTTON_SELECT}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Right\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_RIGHT}\n                prevButton={Controller.BUTTON_LEFT}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Up\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_UP}\n                prevButton={Controller.BUTTON_RIGHT}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Down\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_DOWN}\n                prevButton={Controller.BUTTON_UP}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"A\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_A}\n                prevButton={Controller.BUTTON_DOWN}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"B\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_B}\n                prevButton={Controller.BUTTON_A}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Start\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_START}\n                prevButton={Controller.BUTTON_B}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n              <ControlMapperRow\n                buttonName=\"Select\"\n                currentPromptButton={this.state.currentPromptButton}\n                button={Controller.BUTTON_SELECT}\n                prevButton={Controller.BUTTON_START}\n                keys={this.state.keys}\n                handleClick={this.listenForKey}\n                gamepadConfig={this.state.gamepadConfig}\n              />\n            </tbody>\n          </Table>\n        </ModalBody>\n        <ModalFooter>\n          <Button outline color=\"primary\" onClick={this.props.toggle}>\n            Close\n          </Button>\n        </ModalFooter>\n      </Modal>\n    );\n  }\n}\n\nexport default ControlsModal;\n","const FPS = 60.098;\n\nexport default class FrameTimer {\n  constructor(props) {\n    // Run at 60 FPS\n    this.onGenerateFrame = props.onGenerateFrame;\n    // Run on animation frame\n    this.onWriteFrame = props.onWriteFrame;\n    this.onAnimationFrame = this.onAnimationFrame.bind(this);\n    this.running = true;\n    this.interval = 1e3 / FPS;\n    this.lastFrameTime = false;\n  }\n\n  start() {\n    this.running = true;\n    this.requestAnimationFrame();\n  }\n\n  stop() {\n    this.running = false;\n    if (this._requestID) window.cancelAnimationFrame(this._requestID);\n    this.lastFrameTime = false;\n  }\n\n  requestAnimationFrame() {\n    this._requestID = window.requestAnimationFrame(this.onAnimationFrame);\n  }\n\n  generateFrame() {\n    this.onGenerateFrame();\n    this.lastFrameTime += this.interval;\n  }\n\n  onAnimationFrame = time => {\n    this.requestAnimationFrame();\n    // how many ms after 60fps frame time\n    let excess = time % this.interval;\n\n    // newFrameTime is the current time aligned to 60fps intervals.\n    // i.e. 16.6, 33.3, etc ...\n    let newFrameTime = time - excess;\n\n    // first frame, do nothing\n    if (!this.lastFrameTime) {\n      this.lastFrameTime = newFrameTime;\n      return;\n    }\n\n    let numFrames = Math.round(\n      (newFrameTime - this.lastFrameTime) / this.interval\n    );\n\n    // This can happen a lot on a 144Hz display\n    if (numFrames === 0) {\n      //console.log(\"WOAH, no frames\");\n      return;\n    }\n\n    // update display on first frame only\n    this.generateFrame();\n    this.onWriteFrame();\n\n    // we generate additional frames evenly before the next\n    // onAnimationFrame call.\n    // additional frames are generated but not displayed\n    // until next frame draw\n    let timeToNextFrame = this.interval - excess;\n    for (let i = 1; i < numFrames; i++) {\n      setTimeout(() => {\n        this.generateFrame();\n      }, (i * timeToNextFrame) / numFrames);\n    }\n    if (numFrames > 1) console.log(\"SKIP\", numFrames - 1, this.lastFrameTime);\n  };\n}\n","export default class GamepadController {\n  constructor(options) {\n    this.onButtonDown = options.onButtonDown;\n    this.onButtonUp = options.onButtonUp;\n    this.gamepadState = [];\n    this.buttonCallback = null;\n  }\n\n  disableIfGamepadEnabled = callback => {\n    var self = this;\n    return (playerId, buttonId) => {\n      if (!self.gamepadConfig) {\n        return callback(playerId, buttonId);\n      }\n\n      var playerGamepadId = self.gamepadConfig.playerGamepadId;\n      if (!playerGamepadId || !playerGamepadId[playerId - 1]) {\n        // allow callback only if player is not associated to any gamepad\n        return callback(playerId, buttonId);\n      }\n    };\n  };\n\n  _getPlayerNumberFromGamepad = gamepad => {\n    if (this.gamepadConfig.playerGamepadId[0] === gamepad.id) {\n      return 1;\n    }\n\n    if (this.gamepadConfig.playerGamepadId[1] === gamepad.id) {\n      return 2;\n    }\n\n    return 1;\n  };\n\n  poll = () => {\n    const gamepads = navigator.getGamepads\n      ? navigator.getGamepads()\n      : navigator.webkitGetGamepads();\n\n    const usedPlayers = [];\n\n    for (let gamepadIndex = 0; gamepadIndex < gamepads.length; gamepadIndex++) {\n      const gamepad = gamepads[gamepadIndex];\n      const previousGamepad = this.gamepadState[gamepadIndex];\n\n      if (!gamepad) {\n        continue;\n      }\n\n      if (!previousGamepad) {\n        this.gamepadState[gamepadIndex] = gamepad;\n        continue;\n      }\n\n      const buttons = gamepad.buttons;\n      const previousButtons = previousGamepad.buttons;\n\n      if (this.buttonCallback) {\n        for (let code = 0; code < gamepad.axes.length; code++) {\n          const axis = gamepad.axes[code];\n          const previousAxis = previousGamepad.axes[code];\n\n          if (axis === -1 && previousAxis !== -1) {\n            this.buttonCallback({\n              gamepadId: gamepad.id,\n              type: \"axis\",\n              code: code,\n              value: axis\n            });\n          }\n\n          if (axis === 1 && previousAxis !== 1) {\n            this.buttonCallback({\n              gamepadId: gamepad.id,\n              type: \"axis\",\n              code: code,\n              value: axis\n            });\n          }\n        }\n\n        for (let code = 0; code < buttons.length; code++) {\n          const button = buttons[code];\n          const previousButton = previousButtons[code];\n          if (button.pressed && !previousButton.pressed) {\n            this.buttonCallback({\n              gamepadId: gamepad.id,\n              type: \"button\",\n              code: code\n            });\n          }\n        }\n      } else if (this.gamepadConfig) {\n        let playerNumber = this._getPlayerNumberFromGamepad(gamepad);\n        if (usedPlayers.length < 2) {\n          if (usedPlayers.indexOf(playerNumber) !== -1) {\n            playerNumber++;\n            if (playerNumber > 2) playerNumber = 1;\n          }\n          usedPlayers.push(playerNumber);\n\n          if (this.gamepadConfig.configs[gamepad.id]) {\n            const configButtons = this.gamepadConfig.configs[gamepad.id]\n              .buttons;\n\n            for (let i = 0; i < configButtons.length; i++) {\n              const configButton = configButtons[i];\n              if (configButton.type === \"button\") {\n                const code = configButton.code;\n                const button = buttons[code];\n                const previousButton = previousButtons[code];\n\n                if (button.pressed && !previousButton.pressed) {\n                  this.onButtonDown(playerNumber, configButton.buttonId);\n                } else if (!button.pressed && previousButton.pressed) {\n                  this.onButtonUp(playerNumber, configButton.buttonId);\n                }\n              } else if (configButton.type === \"axis\") {\n                const code = configButton.code;\n                const axis = gamepad.axes[code];\n                const previousAxis = previousGamepad.axes[code];\n\n                if (\n                  axis === configButton.value &&\n                  previousAxis !== configButton.value\n                ) {\n                  this.onButtonDown(playerNumber, configButton.buttonId);\n                }\n\n                if (\n                  axis !== configButton.value &&\n                  previousAxis === configButton.value\n                ) {\n                  this.onButtonUp(playerNumber, configButton.buttonId);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      this.gamepadState[gamepadIndex] = {\n        buttons: buttons.map(b => {\n          return { pressed: b.pressed };\n        }),\n        axes: gamepad.axes.slice(0)\n      };\n    }\n  };\n\n  promptButton = f => {\n    if (!f) {\n      this.buttonCallback = f;\n    } else {\n      this.buttonCallback = buttonInfo => {\n        this.buttonCallback = null;\n        f(buttonInfo);\n      };\n    }\n  };\n\n  loadGamepadConfig = () => {\n    var gamepadConfig;\n    try {\n      gamepadConfig = localStorage.getItem(\"gamepadConfig\");\n      if (gamepadConfig) {\n        gamepadConfig = JSON.parse(gamepadConfig);\n      }\n    } catch (e) {\n      console.log(\"Failed to get gamepadConfig from localStorage.\", e);\n    }\n\n    this.gamepadConfig = gamepadConfig;\n  };\n\n  setGamepadConfig = gamepadConfig => {\n    try {\n      localStorage.setItem(\"gamepadConfig\", JSON.stringify(gamepadConfig));\n      this.gamepadConfig = gamepadConfig;\n    } catch (e) {\n      console.log(\"Failed to set gamepadConfig in localStorage\");\n    }\n  };\n\n  startPolling = () => {\n    if (!(navigator.getGamepads || navigator.webkitGetGamepads)) {\n      return { stop: () => {} };\n    }\n\n    let stopped = false;\n    const loop = () => {\n      if (stopped) return;\n\n      this.poll();\n      requestAnimationFrame(loop);\n    };\n    requestAnimationFrame(loop);\n\n    return {\n      stop: () => {\n        stopped = true;\n      }\n    };\n  };\n}\n","import { Controller } from \"jsnes\";\n\n// Mapping keyboard code to [controller, button]\nconst KEYS = {\n  88: [1, Controller.BUTTON_A, \"X\"], // X\n  89: [1, Controller.BUTTON_B, \"Y\"], // Y (Central European keyboard)\n  90: [1, Controller.BUTTON_B, \"Z\"], // Z\n  17: [1, Controller.BUTTON_SELECT, \"Right Ctrl\"], // Right Ctrl\n  13: [1, Controller.BUTTON_START, \"Enter\"], // Enter\n  38: [1, Controller.BUTTON_UP, \"Up\"], // Up\n  40: [1, Controller.BUTTON_DOWN, \"Down\"], // Down\n  37: [1, Controller.BUTTON_LEFT, \"Left\"], // Left\n  39: [1, Controller.BUTTON_RIGHT, \"Right\"], // Right\n  103: [2, Controller.BUTTON_A, \"Num-7\"], // Num-7\n  105: [2, Controller.BUTTON_B, \"Num-9\"], // Num-9\n  99: [2, Controller.BUTTON_SELECT, \"Num-3\"], // Num-3\n  97: [2, Controller.BUTTON_START, \"Num-1\"], // Num-1\n  104: [2, Controller.BUTTON_UP, \"Num-8\"], // Num-8\n  98: [2, Controller.BUTTON_DOWN, \"Num-2\"], // Num-2\n  100: [2, Controller.BUTTON_LEFT, \"Num-4\"], // Num-4\n  102: [2, Controller.BUTTON_RIGHT, \"Num-6\"] // Num-6\n};\n\nexport default class KeyboardController {\n  constructor(options) {\n    this.onButtonDown = options.onButtonDown;\n    this.onButtonUp = options.onButtonUp;\n  }\n\n  loadKeys = () => {\n    var keys;\n    try {\n      keys = localStorage.getItem(\"keys\");\n      if (keys) {\n        keys = JSON.parse(keys);\n      }\n    } catch (e) {\n      console.log(\"Failed to get keys from localStorage.\", e);\n    }\n\n    this.keys = keys || KEYS;\n  };\n\n  setKeys = newKeys => {\n    try {\n      localStorage.setItem(\"keys\", JSON.stringify(newKeys));\n      this.keys = newKeys;\n    } catch (e) {\n      console.log(\"Failed to set keys in localStorage\");\n    }\n  };\n\n  handleKeyDown = e => {\n    var key = this.keys[e.keyCode];\n    if (key) {\n      this.onButtonDown(key[0], key[1]);\n      e.preventDefault();\n    }\n  };\n\n  handleKeyUp = e => {\n    var key = this.keys[e.keyCode];\n    if (key) {\n      this.onButtonUp(key[0], key[1]);\n      e.preventDefault();\n    }\n  };\n\n  handleKeyPress = e => {\n    e.preventDefault();\n  };\n}\n","import React, { Component } from \"react\";\nimport \"./Screen.css\";\n\nconst SCREEN_WIDTH = 256;\nconst SCREEN_HEIGHT = 240;\n\nclass Screen extends Component {\n  render() {\n    return (\n      <canvas\n        className=\"Screen\"\n        width={SCREEN_WIDTH}\n        height={SCREEN_HEIGHT}\n        onMouseDown={this.handleMouseDown}\n        onMouseUp={this.props.onMouseUp}\n        ref={canvas => {\n          this.canvas = canvas;\n        }}\n      />\n    );\n  }\n\n  componentDidMount() {\n    this.initCanvas();\n  }\n\n  componentDidUpdate() {\n    this.initCanvas();\n  }\n\n  initCanvas() {\n    this.context = this.canvas.getContext(\"2d\");\n    this.imageData = this.context.getImageData(\n      0,\n      0,\n      SCREEN_WIDTH,\n      SCREEN_HEIGHT\n    );\n\n    this.context.fillStyle = \"black\";\n    // set alpha to opaque\n    this.context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n\n    // buffer to write on next animation frame\n    this.buf = new ArrayBuffer(this.imageData.data.length);\n    // Get the canvas buffer in 8bit and 32bit\n    this.buf8 = new Uint8ClampedArray(this.buf);\n    this.buf32 = new Uint32Array(this.buf);\n\n    // Set alpha\n    for (var i = 0; i < this.buf32.length; ++i) {\n      this.buf32[i] = 0xff000000;\n    }\n  }\n\n  setBuffer = buffer => {\n    var i = 0;\n    for (var y = 0; y < SCREEN_HEIGHT; ++y) {\n      for (var x = 0; x < SCREEN_WIDTH; ++x) {\n        i = y * 256 + x;\n        // Convert pixel from NES BGR to canvas ABGR\n        this.buf32[i] = 0xff000000 | buffer[i]; // Full alpha\n      }\n    }\n  };\n\n  writeBuffer = () => {\n    this.imageData.data.set(this.buf8);\n    this.context.putImageData(this.imageData, 0, 0);\n  };\n\n  fitInParent = () => {\n    let parent = this.canvas.parentNode;\n    // @ts-ignore\n    let parentWidth = parent.clientWidth;\n    // @ts-ignore\n    let parentHeight = parent.clientHeight;\n    let parentRatio = parentWidth / parentHeight;\n    let desiredRatio = SCREEN_WIDTH / SCREEN_HEIGHT;\n    if (desiredRatio < parentRatio) {\n      this.canvas.style.width = `${Math.round(parentHeight * desiredRatio)}px`;\n      this.canvas.style.height = `${parentHeight}px`;\n    } else {\n      this.canvas.style.width = `${parentWidth}px`;\n      this.canvas.style.height = `${Math.round(parentWidth / desiredRatio)}px`;\n    }\n  };\n\n  screenshot() {\n    var img = new Image();\n    img.src = this.canvas.toDataURL(\"image/png\");\n    return img;\n  }\n\n  handleMouseDown = e => {\n    if (!this.props.onMouseDown) return;\n    // Make coordinates unscaled\n    let scale = SCREEN_WIDTH / parseFloat(this.canvas.style.width);\n    let rect = this.canvas.getBoundingClientRect();\n    let x = Math.round((e.clientX - rect.left) * scale);\n    let y = Math.round((e.clientY - rect.top) * scale);\n    this.props.onMouseDown(x, y);\n  };\n}\n\nexport default Screen;\n","import Raven from \"raven-js\";\n\nexport const handleError = (error, errorInfo) => {\n  console.error(error);\n  Raven.captureException(error, { extra: errorInfo });\n};\n\nexport function loadBinary(path, callback, handleProgress) {\n  var req = new XMLHttpRequest();\n  req.open(\"GET\", path);\n  req.overrideMimeType(\"text/plain; charset=x-user-defined\");\n  req.onload = function() {\n    if (this.status === 200) {\n      if (req.responseText.match(/^<!doctype html>/i)) {\n        // Got HTML back, so it is probably falling back to index.html due to 404\n        return callback(new Error(\"Page not found\"));\n      }\n\n      callback(null, this.responseText);\n    } else if (this.status === 0) {\n      // Aborted, so ignore error\n    } else {\n      callback(new Error(req.statusText));\n    }\n  };\n  req.onerror = function() {\n    callback(new Error(req.statusText));\n  };\n  req.onprogress = handleProgress;\n  req.send();\n  return req;\n}\n","import RingBuffer from \"ringbufferjs\";\nimport { handleError } from \"./utils\";\n\nexport default class Speakers {\n  constructor({ onBufferUnderrun }) {\n    this.onBufferUnderrun = onBufferUnderrun;\n    this.bufferSize = 8192;\n    this.buffer = new RingBuffer(this.bufferSize * 2);\n  }\n\n  getSampleRate() {\n    if (!window.AudioContext) {\n      return 44100;\n    }\n    let myCtx = new window.AudioContext();\n    let sampleRate = myCtx.sampleRate;\n    myCtx.close();\n    return sampleRate;\n  }\n\n  start() {\n    // Audio is not supported\n    if (!window.AudioContext) {\n      return;\n    }\n    this.audioCtx = new window.AudioContext();\n    this.scriptNode = this.audioCtx.createScriptProcessor(1024, 0, 2);\n    this.scriptNode.onaudioprocess = this.onaudioprocess;\n    this.scriptNode.connect(this.audioCtx.destination);\n  }\n\n  stop() {\n    if (this.scriptNode) {\n      this.scriptNode.disconnect(this.audioCtx.destination);\n      this.scriptNode.onaudioprocess = null;\n      this.scriptNode = null;\n    }\n    if (this.audioCtx) {\n      this.audioCtx.close().catch(handleError);\n      this.audioCtx = null;\n    }\n  }\n\n  writeSample = (left, right) => {\n    if (this.buffer.size() / 2 >= this.bufferSize) {\n      console.log(`Buffer overrun`);\n      this.buffer.deqN(this.bufferSize / 2);\n    }\n    this.buffer.enq(left);\n    this.buffer.enq(right);\n  };\n\n  onaudioprocess = e => {\n    var left = e.outputBuffer.getChannelData(0);\n    var right = e.outputBuffer.getChannelData(1);\n    var size = left.length;\n\n    // We're going to buffer underrun. Attempt to fill the buffer.\n    if (this.buffer.size() < size * 2 && this.onBufferUnderrun) {\n      this.onBufferUnderrun(this.buffer.size(), size * 2);\n    }\n\n    try {\n      var samples = this.buffer.deqN(size * 2);\n    } catch (e) {\n      // onBufferUnderrun failed to fill the buffer, so handle a real buffer\n      // underrun\n\n      // ignore empty buffers... assume audio has just stopped\n      var bufferSize = this.buffer.size() / 2;\n      if (bufferSize > 0) {\n        console.log(`Buffer underrun (needed ${size}, got ${bufferSize})`);\n      }\n      for (var j = 0; j < size; j++) {\n        left[j] = 0;\n        right[j] = 0;\n      }\n      return;\n    }\n    for (var i = 0; i < size; i++) {\n      left[i] = samples[i * 2];\n      right[i] = samples[i * 2 + 1];\n    }\n  };\n}\n","import Raven from \"raven-js\";\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { NES } from \"jsnes\";\n\nimport FrameTimer from \"./FrameTimer\";\nimport GamepadController from \"./GamepadController\";\nimport KeyboardController from \"./KeyboardController\";\nimport Screen from \"./Screen\";\nimport Speakers from \"./Speakers\";\n\n/*\n * Runs the emulator.\n *\n * The only UI is a canvas element. It assumes it is a singleton in various ways\n * (binds to window, keyboard, speakers, etc).\n */\nclass Emulator extends Component {\n  render() {\n    return (\n      <Screen\n        ref={screen => {\n          this.screen = screen;\n        }}\n        onGenerateFrame={() => {\n          this.nes.frame();\n        }}\n        onMouseDown={(x, y) => {\n          this.nes.zapperMove(x, y);\n          this.nes.zapperFireDown();\n        }}\n        onMouseUp={() => {\n          this.nes.zapperFireUp();\n        }}\n      />\n    );\n  }\n\n  componentDidMount() {\n    // Initial layout\n    this.fitInParent();\n\n    this.speakers = new Speakers({\n      onBufferUnderrun: (actualSize, desiredSize) => {\n        if (this.props.paused) {\n          return;\n        }\n        // Skip a video frame so audio remains consistent. This happens for\n        // a variety of reasons:\n        // - Frame rate is not quite 60fps, so sometimes buffer empties\n        // - Page is not visible, so requestAnimationFrame doesn't get fired.\n        //   In this case emulator still runs at full speed, but timing is\n        //   done by audio instead of requestAnimationFrame.\n        // - System can't run emulator at full speed. In this case it'll stop\n        //    firing requestAnimationFrame.\n        console.log(\n          \"Buffer underrun, running another frame to try and catch up\"\n        );\n\n        this.frameTimer.generateFrame();\n        // desiredSize will be 2048, and the NES produces 1468 samples on each\n        // frame so we might need a second frame to be run. Give up after that\n        // though -- the system is not catching up\n        if (this.speakers.buffer.size() < desiredSize) {\n          console.log(\"Still buffer underrun, running a second frame\");\n          this.frameTimer.generateFrame();\n        }\n      }\n    });\n\n    this.nes = new NES({\n      onFrame: this.screen.setBuffer,\n      onStatusUpdate: console.log,\n      onAudioSample: this.speakers.writeSample,\n      sampleRate: this.speakers.getSampleRate()\n    });\n\n    // For debugging. ([\"nes\"] instead of .nes to avoid VS Code type errors.)\n    window[\"nes\"] = this.nes;\n\n    this.frameTimer = new FrameTimer({\n      onGenerateFrame: Raven.wrap(this.nes.frame),\n      onWriteFrame: Raven.wrap(this.screen.writeBuffer)\n    });\n\n    // Set up gamepad and keyboard\n    this.gamepadController = new GamepadController({\n      onButtonDown: this.nes.buttonDown,\n      onButtonUp: this.nes.buttonUp\n    });\n\n    this.gamepadController.loadGamepadConfig();\n    this.gamepadPolling = this.gamepadController.startPolling();\n\n    this.keyboardController = new KeyboardController({\n      onButtonDown: this.gamepadController.disableIfGamepadEnabled(\n        this.nes.buttonDown\n      ),\n      onButtonUp: this.gamepadController.disableIfGamepadEnabled(\n        this.nes.buttonUp\n      )\n    });\n\n    // Load keys from localStorage (if they exist)\n    this.keyboardController.loadKeys();\n\n    document.addEventListener(\"keydown\", this.keyboardController.handleKeyDown);\n    document.addEventListener(\"keyup\", this.keyboardController.handleKeyUp);\n    document.addEventListener(\n      \"keypress\",\n      this.keyboardController.handleKeyPress\n    );\n\n    this.nes.loadROM(this.props.romData);\n    this.start();\n  }\n\n  componentWillUnmount() {\n    this.stop();\n\n    // Unbind keyboard\n    document.removeEventListener(\n      \"keydown\",\n      this.keyboardController.handleKeyDown\n    );\n    document.removeEventListener(\"keyup\", this.keyboardController.handleKeyUp);\n    document.removeEventListener(\n      \"keypress\",\n      this.keyboardController.handleKeyPress\n    );\n\n    // Stop gamepad\n    this.gamepadPolling.stop();\n\n    window[\"nes\"] = undefined;\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.paused !== prevProps.paused) {\n      if (this.props.paused) {\n        this.stop();\n      } else {\n        this.start();\n      }\n    }\n\n    // TODO: handle changing romData\n  }\n\n  start = () => {\n    this.frameTimer.start();\n    this.speakers.start();\n    this.fpsInterval = setInterval(() => {\n      console.log(`FPS: ${this.nes.getFPS()}`);\n    }, 1000);\n  };\n\n  stop = () => {\n    this.frameTimer.stop();\n    this.speakers.stop();\n    clearInterval(this.fpsInterval);\n  };\n\n  /*\n   * Fill parent element with screen. Typically called if parent element changes size.\n   */\n  fitInParent() {\n    this.screen.fitInParent();\n  }\n}\n\nEmulator.propTypes = {\n  paused: PropTypes.bool,\n  romData: PropTypes.string.isRequired\n};\n\nexport default Emulator;\n","import React, { FunctionComponent, MouseEventHandler } from \"react\"; // importing FunctionComponent\nimport { Controller } from \"jsnes\";\nimport \"./NesController.css\";\n\nexport const mouseToKeyPressHandlers = (key, interval = 4) => {\n  let originalColor;\n  return {\n    touchStartHandler: e => {\n      const nes = window[\"nes\"];\n      e.persist();\n\n      // @ts-ignore\n      originalColor = e.target.style.fill;\n\n      nes.buttonDown(key[0], key[1]);\n      // @ts-ignore\n      e.target.style.fill = \"#00FF00\";\n      e.preventDefault();\n    },\n    touchEndHandler: e => {\n      const nes = window[\"nes\"];\n      e.persist();\n      nes.buttonUp(key[0], key[1]);\n      // @ts-ignore\n      e.target.style.fill = originalColor;\n      e.preventDefault();\n    }\n  };\n};\n\nexport const defaultPlayer1Controller = {\n  scalePercentage: 100,\n  dPadUp: mouseToKeyPressHandlers([1, Controller.BUTTON_UP]),\n  dPadDown: mouseToKeyPressHandlers([1, Controller.BUTTON_DOWN]),\n  dPadRight: mouseToKeyPressHandlers([1, Controller.BUTTON_RIGHT]),\n  dPadLeft: mouseToKeyPressHandlers([1, Controller.BUTTON_LEFT]),\n  a: mouseToKeyPressHandlers([1, Controller.BUTTON_A]),\n  b: mouseToKeyPressHandlers([1, Controller.BUTTON_B]),\n  start: mouseToKeyPressHandlers([1, Controller.BUTTON_START]),\n  select: mouseToKeyPressHandlers([1, Controller.BUTTON_SELECT])\n};\n\nexport const defaultPlayer2Controller = {\n  scalePercentage: 100,\n  dPadUp: mouseToKeyPressHandlers([2, Controller.BUTTON_UP]),\n  dPadDown: mouseToKeyPressHandlers([2, Controller.BUTTON_DOWN]),\n  dPadRight: mouseToKeyPressHandlers([2, Controller.BUTTON_RIGHT]),\n  dPadLeft: mouseToKeyPressHandlers([2, Controller.BUTTON_LEFT]),\n  a: mouseToKeyPressHandlers([2, Controller.BUTTON_A]),\n  b: mouseToKeyPressHandlers([2, Controller.BUTTON_B]),\n  start: mouseToKeyPressHandlers([2, Controller.BUTTON_START]),\n  select: mouseToKeyPressHandlers([2, Controller.BUTTON_SELECT])\n};\n\nconst handleClick = () => {\n  console.log(\"Click\");\n};\n\nexport const NesController = ({\n  scalePercentage,\n  dPadUp,\n  dPadDown,\n  dPadLeft,\n  dPadRight,\n  a,\n  b,\n  select,\n  start\n}) => {\n  return (\n    <div className=\"NesController\">\n      <svg\n        version=\"1.1\"\n        id=\"svg2\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width={`${scalePercentage}%`}\n        height={`${scalePercentage}%`}\n        viewBox=\"-0.004 270.034 612.002 251.924\"\n        enableBackground=\"new -0.004 270.034 612.002 251.924\"\n      >\n        <switch>\n          <g>\n            <g>\n              <rect\n                id=\"controllerBackground\"\n                x=\"15.947\"\n                y=\"311.988\"\n                fill=\"#1A1A1A\"\n                width=\"581.833\"\n                height=\"195.284\"\n              />\n              <path\n                id=\"greyStripe1\"\n                fill=\"#808080\"\n                d=\"M205.958,305.043h153.281c5.362,0,9.709,4.347,9.709,9.709v10.594 c0,5.362-4.347,9.709-9.709,9.709H205.958c-5.362,0-9.709-4.347-9.709-9.709v-10.594 C196.25,309.39,200.597,305.043,205.958,305.043z\"\n              />\n              <path\n                id=\"greyStripe2a\"\n                fill=\"#808080\"\n                d=\"M205.958,343.667h153.281c5.362,0,9.709,4.347,9.709,9.708v10.594 c0,5.362-4.347,9.709-9.709,9.709H205.958c-5.362,0-9.709-4.347-9.709-9.709v-10.594 C196.25,348.014,200.597,343.667,205.958,343.667z\"\n              />\n              <path\n                id=\"greyStripe4\"\n                fill=\"#808080\"\n                d=\"M205.958,488.063h153.281c5.362,0,9.709,4.347,9.709,9.709v10.594 c0,5.362-4.347,9.709-9.709,9.709H205.958c-5.362,0-9.709-4.347-9.709-9.709v-10.594 C196.25,492.409,200.597,488.063,205.958,488.063z\"\n              />\n              <path\n                id=\"greyPlasticShell\"\n                fill=\"#DCDCDC\"\n                d=\"M8.147,270.034c-4.508,0-8.152,3.644-8.152,8.152v235.621 c0,4.508,3.645,8.152,8.152,8.151h595.897c4.508,0,7.953-3.644,7.953-8.151V278.186c0-4.508-3.445-8.152-7.953-8.152H8.147 L8.147,270.034z M15.902,311.988h581.986v195.25H15.902V311.988L15.902,311.988z\"\n              />\n              <path\n                id=\"dPadOutline\"\n                stroke=\"#FFFFFF\"\n                strokeWidth=\"1.6523\"\n                strokeLinecap=\"round\"\n                d=\"M87.542,362.004 c-2.686,0-4.713,2.216-4.713,4.902v33.747H49.082c-2.686,0-4.902,2.217-4.902,4.902v27.148c0,2.686,2.216,4.901,4.902,4.901 h33.747v33.747c0,2.686,2.028,4.714,4.713,4.714h27.337c2.686,0,4.713-2.027,4.713-4.714v-33.747h33.747 c2.686,0,4.902-2.216,4.902-4.901v-27.148c0-2.686-2.216-4.902-4.902-4.902h-33.747v-33.747c0-2.686-2.028-4.902-4.713-4.902 H87.542z\"\n              />\n              <path\n                id=\"dPad\"\n                fill=\"#1A1A1A\"\n                d=\"M88.484,366.254c-0.85,0-1.506,0.657-1.506,1.506v36.832H50.146 c-0.849,0-1.506,0.656-1.506,1.506v25.948c0,0.85,0.657,1.574,1.506,1.574h36.832v36.765c0,0.849,0.657,1.574,1.506,1.574H114.5 c0.85,0,1.506-0.726,1.506-1.574V433.62h36.832c0.85,0,1.506-0.725,1.506-1.574v-25.948c0-0.85-0.657-1.506-1.506-1.506h-36.832 V367.76c0-0.85-0.656-1.506-1.506-1.506H88.484z\"\n              />\n              <rect\n                id=\"dPadUpTouchPad\"\n                fill=\"#1A1A1A\"\n                x=\"86\"\n                y=\"365\"\n                height=\"35\"\n                width=\"30\"\n                onTouchCancel={dPadUp?.touchEndHandler}\n                onTouchEnd={dPadUp?.touchEndHandler}\n                onTouchStart={dPadUp?.touchStartHandler}\n              />\n              <rect\n                id=\"dPadDownTouchPad\"\n                fill=\"#1A1A1A\"\n                x=\"86\"\n                y=\"438\"\n                height=\"35\"\n                width=\"30\"\n                onTouchCancel={dPadDown?.touchEndHandler}\n                onTouchEnd={dPadDown?.touchEndHandler}\n                onTouchStart={dPadDown?.touchStartHandler}\n              />\n              <rect\n                id=\"dPadLeftTouchPad\"\n                fill=\"#1A1A1A\"\n                x=\"48\"\n                y=\"404\"\n                height=\"30\"\n                width=\"35\"\n                onTouchStart={dPadLeft?.touchStartHandler}\n                onTouchCancel={dPadLeft?.touchEndHandler}\n                onTouchEnd={dPadLeft?.touchEndHandler}\n              />\n              <rect\n                id=\"dPadRigthTouchPad\"\n                fill=\"#1A1A1A\"\n                x=\"120\"\n                y=\"404\"\n                height=\"30\"\n                width=\"35\"\n                onTouchCancel={dPadRight?.touchEndHandler}\n                onTouchEnd={dPadRight?.touchEndHandler}\n                onTouchStart={dPadRight?.touchStartHandler}\n              />\n              <g\n                id=\"g12011\"\n                transform=\"matrix(2.9042238,0,0,2.9042238,-597.29495,-994.37335)\"\n              >\n                <path\n                  id=\"bButtonBorder\"\n                  fill=\"#DDDDDD\"\n                  d=\"M343.472,484.842h20.578c0.908,0,1.643,0.736,1.643,1.643v20.578 c0,0.907-0.735,1.643-1.643,1.643h-20.578c-0.908,0-1.643-0.736-1.643-1.643v-20.578 C341.829,485.577,342.565,484.842,343.472,484.842z\"\n                />\n                <path\n                  id=\"bButton\"\n                  fill=\"#FF0000\"\n                  d=\"M363.54,496.875c0,5.402-4.379,9.78-9.78,9.78s-9.78-4.379-9.78-9.78 s4.379-9.78,9.78-9.78S363.54,491.473,363.54,496.875z\"\n                  onTouchCancel={b?.touchEndHandler}\n                  onTouchEnd={b?.touchEndHandler}\n                  onTouchStart={b?.touchStartHandler}\n                />\n              </g>\n              <g\n                id=\"g12007\"\n                transform=\"matrix(2.9042238,0,0,2.9042238,-597.29495,-994.37335)\"\n              >\n                <path\n                  id=\"aButtonBorder\"\n                  fill=\"#DDDDDD\"\n                  d=\"M370.572,484.842h20.578c0.907,0,1.643,0.736,1.643,1.643v20.578\n\t\t\t\t\tc0,0.907-0.736,1.643-1.643,1.643h-20.578c-0.908,0-1.643-0.736-1.643-1.643v-20.578\n\t\t\t\t\tC368.929,485.577,369.665,484.842,370.572,484.842z\"\n                />\n                <path\n                  id=\"aButton\"\n                  fill=\"#FF0000\"\n                  d=\"M390.65,496.875c0,5.402-4.379,9.78-9.78,9.78c-5.402,0-9.781-4.379-9.781-9.78\n\t\t\t\t\ts4.379-9.78,9.781-9.78C386.271,487.094,390.65,491.473,390.65,496.875z\"\n                  onTouchCancel={a?.touchEndHandler}\n                  onTouchEnd={a?.touchEndHandler}\n                  onTouchStart={a?.touchStartHandler}\n                  onMouseDown={a?.touchStartHandler}\n                  onMouseUp={a?.touchEndHandler}\n                />\n              </g>\n              <path\n                id=\"selectStartTextBackground\"\n                fill=\"#808080\"\n                d=\"M205.958,382.312h153.281c5.362,0,9.709,4.347,9.709,9.709v10.594\n\t\t\t\tc0,5.362-4.347,9.709-9.709,9.709H205.958c-5.362,0-9.709-4.347-9.709-9.709v-10.594\n\t\t\t\tC196.249,386.659,200.597,382.312,205.958,382.312z\"\n              />\n              <path\n                id=\"selectStartButtonBackground\"\n                fill=\"#DDDDDD\"\n                d=\"M207.071,420.454h151.087c5.976,0,10.82,4.845,10.82,10.821v35.343\n\t\t\t\tc0,5.977-4.845,10.821-10.82,10.821H207.071c-5.977,0-10.821-4.845-10.821-10.821v-35.343\n\t\t\t\tC196.249,425.299,201.094,420.454,207.071,420.454z\"\n              />\n              <path\n                id=\"selectStartButtonBackgroundBorder\"\n                fill=\"none\"\n                stroke=\"#808080\"\n                strokeWidth=\"1.4584\"\n                strokeLinecap=\"round\"\n                d=\"M212.19,425.887h140.876\n\t\t\t\tc4.896,0,8.864,3.969,8.864,8.864v28.951c0,4.896-3.969,8.863-8.864,8.863H212.19c-4.896,0-8.864-3.968-8.864-8.863v-28.951\n\t\t\t\tC203.326,429.856,207.294,425.887,212.19,425.887z\"\n              />\n              <path\n                id=\"rect4247\"\n                d=\"M225.68,440.412h29.395c5.28,0,9.56,4.28,9.56,9.561l0,0c0,5.279-4.28,9.56-9.56,9.56H225.68\n\t\t\t\tc-5.28,0-9.56-4.28-9.56-9.56l0,0C216.12,444.692,220.4,440.412,225.68,440.412z\"\n              />\n              <path\n                id=\"rect5332\"\n                d=\"M309.676,440.412h29.395c5.28,0,9.561,4.28,9.561,9.561l0,0c0,5.279-4.28,9.56-9.561,9.56h-29.395\n\t\t\t\tc-5.28,0-9.561-4.28-9.561-9.56l0,0C300.115,444.692,304.395,440.412,309.676,440.412z\"\n              />\n              <g id=\"nintendoText\">\n                <path\n                  id=\"path6991\"\n                  fill=\"#FE0016\"\n                  d=\"M429.575,346.888v15.725h-5.008l-6.401-10.653c-0.354-0.699-0.354-0.014-0.354-0.014\n\t\t\t\t\tv10.667h-5.125v-15.725h5.125c0,0,6.106,10.071,6.44,10.544c0.314,0.474,0.314,0,0.314,0v-10.544H429.575\"\n                />\n                <path\n                  id=\"path6995\"\n                  fill=\"#FE0016\"\n                  d=\"M432.127,349.752h4.692v-2.865h-4.692V349.752z\"\n                />\n                <path\n                  id=\"path6999\"\n                  fill=\"#FE0016\"\n                  d=\"M461.759,349.205v1.705h2.101l0.079,1.037h-2.18v10.667h-4.89v-10.667h-2.199l0.06-1.037\n\t\t\t\t\th2.14v-1.705H461.759\"\n                />\n                <path\n                  id=\"path7003\"\n                  fill=\"#FE0016\"\n                  d=\"M452.47,352.47c1.178,0.938,1.59,2.751,1.59,2.751v7.391h-4.929v-7.267\n\t\t\t\t\tc0,0-0.373-1.716-2.297-1.705c-1.904,0.012-2.277,1.581-2.277,1.581v7.391h-4.812v-10.666h4.812\n\t\t\t\t\tc0.49,0.915,1.649-0.183,2.65-0.354C449.033,351.008,451.017,351.593,452.47,352.47\"\n                />\n                <path\n                  id=\"path7007\"\n                  fill=\"#FE0016\"\n                  d=\"M432.127,362.612h4.692v-10.667h-4.692V362.612z\"\n                />\n                <path\n                  id=\"path7011\"\n                  fill=\"#FE0016\"\n                  d=\"M473.089,360.845c0,0-0.433,1.463-1.983,1.463c-1.552,0-1.905-1.646-1.905-1.646\n\t\t\t\t\tl0.06-3.232h8.935c-0.021-2.985-1.276-4.143-2.298-4.876c-3.004-1.646-7.266-1.62-10.191,0.719\n\t\t\t\t\tc-1.021,0.878-1.747,2.488-1.669,4.023c0,1.39,0.569,2.778,1.532,3.731c1.904,1.608,4.752,2.338,7.54,1.755\n\t\t\t\t\tc1.826-0.585,4.163-1.463,4.673-3.511h-4.673L473.089,360.845L473.089,360.845z M469.357,354.088c0,0,0.314-1.412,1.904-1.412\n\t\t\t\t\tc1.571,0,1.768,1.549,1.768,1.549l0.039,1.438h-3.711V354.088\"\n                />\n                <path\n                  id=\"path7015\"\n                  fill=\"#FE0016\"\n                  d=\"M504.899,346.886v5.471c-1.61-0.878-4.301-1.424-5.989-0.326\n\t\t\t\t\tc-2.121,1.023-2.848,3.438-2.926,5.559c0.078,1.608,1.021,3.436,2.415,4.389c1.748,1.068,4.084,1.221,6.048,0.404\n\t\t\t\t\tc0.177-0.079,0.373-0.163,0.53-0.259c0.157,0.122,0.354,0.218,0.569,0.295c1.395,0.483,3.868,0.194,3.868,0.194v-15.727H504.899\n\t\t\t\t\tL504.899,346.886z M504.899,360.708c0,0-0.491,1.039-1.886,1.051c-1.1-0.012-1.846-0.792-1.846-0.792v-7.01\n\t\t\t\t\tc0,0,0.314-0.988,1.729-0.974c1.414,0.01,2.003,0.974,2.003,0.974V360.708\"\n                />\n                <path\n                  id=\"path7019\"\n                  fill=\"#FE0016\"\n                  d=\"M492.92,352.512c1.159,0.938,1.591,2.751,1.591,2.751v7.391h-4.948v-7.268\n\t\t\t\t\tc0,0-0.373-1.716-2.278-1.704c-1.924,0.014-2.277,1.581-2.277,1.581v7.391h-4.831v-10.667h4.831\n\t\t\t\t\tc0.471,0.915,1.63-0.183,2.631-0.352C489.464,351.049,491.447,351.636,492.92,352.512\"\n                />\n                <path\n                  id=\"path7023\"\n                  fill=\"#FE0016\"\n                  d=\"M518.625,351.276c-3.967,0-7.167,2.606-7.167,5.82c0,3.212,3.2,5.818,7.167,5.818\n\t\t\t\t\tc3.946-0.002,7.147-2.606,7.147-5.818C525.772,353.882,522.572,351.276,518.625,351.276z M520.549,360.56\n\t\t\t\t\tc0,0-0.49,1.039-1.904,1.05c-1.08-0.012-1.826-0.791-1.826-0.791v-7.01c0,0,0.295-0.988,1.708-0.974\n\t\t\t\t\tc1.414,0.012,2.022,0.974,2.022,0.974V360.56\"\n                />\n                <path\n                  id=\"path7027\"\n                  fill=\"#FE0016\"\n                  d=\"M527.859,352.205c1.039,0,2.021-0.411,2.765-1.148c0.741-0.74,1.159-1.721,1.159-2.764\n\t\t\t\t\tc0-1.043-0.418-2.024-1.159-2.764c-0.744-0.737-1.726-1.148-2.765-1.148c-2.17,0-3.924,1.754-3.924,3.912\n\t\t\t\t\tc0,1.043,0.417,2.024,1.159,2.764C525.838,351.795,526.818,352.205,527.859,352.205L527.859,352.205z M524.708,348.293\n\t\t\t\t\tc0-0.838,0.328-1.625,0.922-2.217c0.595-0.591,1.397-0.918,2.229-0.918s1.635,0.327,2.229,0.918\n\t\t\t\t\tc0.564,0.592,0.892,1.379,0.892,2.217c0,1.73-1.397,3.136-3.121,3.136c-0.832,0-1.635-0.327-2.229-0.918\n\t\t\t\t\tC525.036,349.919,524.708,349.131,524.708,348.293\"\n                />\n                <path\n                  id=\"path7029\"\n                  fill=\"#FE0016\"\n                  d=\"M527.025,346.697h1.338c0.178,0,0.327,0.027,0.444,0.077\n\t\t\t\t\tc0.18,0.104,0.299,0.297,0.299,0.579c0,0.262-0.089,0.447-0.237,0.547c-0.149,0.098-0.328,0.152-0.596,0.152h-1.248V346.697\n\t\t\t\t\tL527.025,346.697z M527.025,350.204v-1.703h1.248c0.208,0,0.388,0.021,0.476,0.071c0.18,0.089,0.269,0.265,0.297,0.523\n\t\t\t\t\tl0.03,0.66c0,0.158,0,0.262,0.03,0.315c0,0.054,0,0.098,0.03,0.134h0.653v-0.092c-0.089-0.036-0.118-0.115-0.149-0.24\n\t\t\t\t\tc-0.03-0.075-0.059-0.188-0.059-0.339l-0.03-0.532c0-0.229-0.029-0.397-0.118-0.499c-0.06-0.104-0.179-0.188-0.357-0.25\n\t\t\t\t\tc0.179-0.092,0.327-0.214,0.417-0.362c0.117-0.155,0.147-0.351,0.147-0.585c0-0.458-0.178-0.77-0.564-0.939\n\t\t\t\t\tc-0.178-0.089-0.445-0.131-0.742-0.131h-1.843v3.971H527.025\"\n                />\n              </g>\n              <g id=\"selectText\">\n                <path\n                  id=\"path2921\"\n                  fill=\"#FF0000\"\n                  d=\"M205.847,403.028h7.825c2.236,0,3.354-1.025,3.354-3.075c0-2.049-1.118-3.074-3.354-3.074\n\t\t\t\t\th-5.589v-1.676h8.943v-2.236h-7.825c-2.236,0-3.354,1.039-3.354,3.118c0,2.02,1.118,3.03,3.354,3.03h5.589v1.677h-8.943V403.028\n\t\t\t\t\tz\"\n                />\n                <path\n                  id=\"path2923\"\n                  fill=\"#FF0000\"\n                  d=\"M229.324,403.028h-7.825c-2.235,0-3.354-1.118-3.354-3.354v-6.707h11.179v2.235h-8.943\n\t\t\t\t\tv1.676h8.943v2.235h-8.943v0.56c0,0.745,0.373,1.118,1.118,1.118h7.825V403.028z\"\n                />\n                <path\n                  id=\"path2925\"\n                  fill=\"#FF0000\"\n                  d=\"M230.427,392.954v6.707c0,2.235,1.118,3.354,3.353,3.354h7.826v-2.235h-7.826\n\t\t\t\t\tc-0.745,0-1.118-0.373-1.118-1.118v-6.707H230.427z\"\n                />\n                <path\n                  id=\"path2927\"\n                  fill=\"#FF0000\"\n                  d=\"M253.903,403.028h-7.825c-2.236,0-3.353-1.118-3.353-3.354v-6.707h11.178v2.235h-8.943\n\t\t\t\t\tv1.676h8.943v2.235h-8.943v0.56c0,0.745,0.373,1.118,1.118,1.118h7.825V403.028z\"\n                />\n                <path\n                  id=\"path2929\"\n                  fill=\"#FF0000\"\n                  d=\"M266.204,403.028h-7.825c-2.236,0-3.354-1.118-3.354-3.354v-3.354\n\t\t\t\t\tc0-2.235,1.118-3.353,3.354-3.353h7.825v2.235h-7.825c-0.746,0-1.118,0.373-1.118,1.118v3.354c0,0.745,0.373,1.118,1.118,1.118\n\t\t\t\t\th7.825V403.028z\"\n                />\n                <path\n                  id=\"path2931\"\n                  fill=\"#FF0000\"\n                  d=\"M267.328,392.954h11.179v2.236h-4.472v7.825h-2.235v-7.825h-4.472V392.954z\"\n                />\n              </g>\n              <g id=\"startText\">\n                <path\n                  id=\"path2934\"\n                  fill=\"#FF0000\"\n                  d=\"M298.659,403.028h7.825c2.236,0,3.352-1.025,3.352-3.075c0-2.049-1.116-3.074-3.352-3.074\n\t\t\t\t\th-5.59v-1.676h8.942v-2.236h-7.824c-2.236,0-3.354,1.039-3.354,3.119c0,2.02,1.118,3.029,3.354,3.029h5.589v1.677h-8.943\n\t\t\t\t\tV403.028z\"\n                />\n                <path\n                  id=\"path2936\"\n                  fill=\"#FF0000\"\n                  d=\"M310.937,392.954h11.18v2.236h-4.472v7.825h-2.236v-7.825h-4.472V392.954z\"\n                />\n                <path\n                  id=\"path2938\"\n                  fill=\"#FF0000\"\n                  d=\"M332.187,397.991v-1.677c0-0.746-0.373-1.119-1.118-1.119h-4.471\n\t\t\t\t\tc-0.746,0-1.118,0.373-1.118,1.119v1.677H332.187z M325.48,400.226v2.795h-2.235v-6.707c0-2.236,1.118-3.354,3.354-3.354h4.471\n\t\t\t\t\tc2.236,0,3.354,1.118,3.354,3.354v6.707h-2.236v-2.795H325.48z\"\n                />\n                <path\n                  id=\"path2940\"\n                  fill=\"#FF0000\"\n                  d=\"M337.765,396.867h6.708v-1.677h-6.708V396.867z M337.765,399.102v3.912h-2.234v-10.06\n\t\t\t\t\th7.824c2.236,0,3.354,1.021,3.354,3.063c0,0.969-0.16,1.681-0.48,2.135c0.32,0.529,0.48,1.219,0.48,2.068v2.794h-2.235v-2.794\n\t\t\t\t\tc0-0.745-0.373-1.118-1.118-1.118H337.765z\"\n                />\n                <path\n                  id=\"path2942\"\n                  fill=\"#FF0000\"\n                  d=\"M347.839,392.954h11.179v2.236h-4.472v7.825h-2.235v-7.825h-4.472V392.954z\"\n                />\n              </g>\n              <g id=\"bText\">\n                <path\n                  id=\"path2945\"\n                  fill=\"#FF0000\"\n                  d=\"M457.062,493.145h8.023v-2.006h-8.023V493.145z M457.062,497.825h8.023v-2.006h-8.023\n\t\t\t\t\tV497.825z M454.389,500.499v-12.034h9.36c2.674,0,4.011,1.212,4.011,3.637c0,0.99-0.214,1.783-0.642,2.381\n\t\t\t\t\tc0.428,0.588,0.642,1.377,0.642,2.366c0,2.434-1.337,3.65-4.011,3.65H454.389z\"\n                />\n              </g>\n              <g id=\"aText\">\n                <path\n                  id=\"path2948\"\n                  fill=\"#FF0000\"\n                  d=\"M543.818,494.985v-2.006c0-0.892-0.445-1.337-1.337-1.337h-5.349\n\t\t\t\t\tc-0.892,0-1.337,0.445-1.337,1.337v2.006H543.818z M535.796,497.659v3.344h-2.675v-8.023c0-2.674,1.338-4.011,4.012-4.011h5.349\n\t\t\t\t\tc2.674,0,4.011,1.337,4.011,4.011v8.023h-2.674v-3.344H535.796z\"\n                />\n              </g>\n              <path\n                id=\"dPadLeftArrow\"\n                stroke=\"#000000\"\n                strokeWidth=\"0.5\"\n                d=\"M63.181,408.339l-5.477,5.478l-5.477,5.477l5.477,5.478\n\t\t\t\tl5.477,5.477v-3.286h10.954v-15.336H63.181V408.339z\"\n                onTouchCancel={dPadLeft?.touchEndHandler}\n                onTouchEnd={dPadLeft?.touchEndHandler}\n                onTouchStart={dPadLeft?.touchStartHandler}\n              />\n              <path\n                id=\"dPadRightArrow\"\n                stroke=\"#000000\"\n                strokeWidth=\"0.5\"\n                d=\"M139.683,408.339l5.477,5.478l5.477,5.477l-5.477,5.478\n\t\t\t\tl-5.477,5.477v-3.286h-10.954v-15.336h10.954V408.339z\"\n                onTouchCancel={dPadRight?.touchEndHandler}\n                onTouchEnd={dPadRight?.touchEndHandler}\n                onTouchStart={dPadRight?.touchStartHandler}\n              />\n              <path\n                id=\"dPadUpArrow\"\n                stroke=\"#000000\"\n                strokeWidth=\"0.5\"\n                d=\"M112.276,380.669l-5.477-5.477l-5.477-5.477\n\t\t\t\tl-5.477,5.477l-5.477,5.477h3.286v10.954h15.336v-10.954H112.276z\"\n                onTouchCancel={dPadUp?.touchEndHandler}\n                onTouchEnd={dPadUp?.touchEndHandler}\n                onTouchStart={dPadUp?.touchStartHandler}\n              />\n              <path\n                id=\"dPadDownArrow\"\n                stroke=\"#000000\"\n                strokeWidth=\"0.5\"\n                d=\"M112.276,458.333l-5.477,5.478l-5.477,5.477\n\t\t\t\tl-5.477-5.477l-5.477-5.478h3.286v-10.954h15.336v10.954H112.276z\"\n                onTouchCancel={dPadDown?.touchEndHandler}\n                onTouchEnd={dPadDown?.touchEndHandler}\n                onTouchStart={dPadDown?.touchStartHandler}\n              />\n              <path\n                id=\"dPadMiddle\"\n                fill=\"none\"\n                stroke=\"#000000\"\n                strokeWidth=\"0.7366\"\n                d=\"M114.646,419.111\n\t\t\t\tc0.004,7.26-5.876,13.148-13.136,13.153s-13.148-5.877-13.153-13.136c0-0.006,0-0.012,0-0.018\n\t\t\t\tc-0.005-7.26,5.876-13.148,13.136-13.153c7.259-0.005,13.148,5.876,13.153,13.136\n\t\t\t\tC114.646,419.099,114.646,419.105,114.646,419.111z\"\n              />\n              <path\n                id=\"selectButtonInner\"\n                fill=\"#1A1A1A\"\n                d=\"M228.2,442.274h24.391c5.28,0,9.56,3.448,9.56,7.702l0,0c0,4.254-4.28,7.702-9.56,7.702\n\t\t\t\tH228.2c-5.28,0-9.56-3.448-9.56-7.702l0,0C218.64,445.722,222.92,442.274,228.2,442.274z\"\n                onTouchCancel={select?.touchEndHandler}\n                onTouchEnd={select?.touchEndHandler}\n                onTouchStart={select?.touchStartHandler}\n              />\n              <path\n                id=\"startButtonInner\"\n                fill=\"#1A1A1A\"\n                d=\"M312.173,442.274h24.392c5.279,0,9.56,3.448,9.56,7.702l0,0c0,4.254-4.28,7.702-9.56,7.702\n\t\t\t\th-24.392c-5.279,0-9.56-3.448-9.56-7.702l0,0C302.613,445.722,306.893,442.274,312.173,442.274z\"\n                onTouchCancel={start?.touchEndHandler}\n                onTouchEnd={start?.touchEndHandler}\n                onTouchStart={start?.touchStartHandler}\n                onMouseUp={start?.touchEndHandler}\n                onMouseDown={start?.touchStartHandler}\n              />\n            </g>\n          </g>\n        </switch>\n      </svg>\n    </div>\n  );\n};\n","import React, { Component } from \"react\";\nimport { Button, Progress } from \"reactstrap\";\nimport { Link } from \"react-router-dom\";\n\nimport config from \"./config\";\nimport ControlsModal from \"./ControlsModal\";\nimport Emulator from \"./Emulator\";\nimport RomLibrary from \"./RomLibrary\";\nimport { loadBinary } from \"./utils\";\nimport { defaultPlayer1Controller, NesController } from \"./NesController\";\n\nimport \"./RunPage.css\";\n\n/*\n * The UI for the emulator. Also responsible for loading ROM from URL or file.\n */\nclass RunPage extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      romName: null,\n      romData: null,\n      running: false,\n      paused: false,\n      controlsModalOpen: false,\n      loading: true,\n      loadedPercent: 3,\n      error: null\n    };\n  }\n\n  render() {\n    return (\n      <div className=\"RunPage\">\n        <nav\n          className=\"navbar navbar-expand\"\n          ref={el => {\n            this.navbar = el;\n          }}\n        >\n          <ul className=\"navbar-nav\" style={{ width: \"200px\" }}>\n            <li className=\"navitem\">\n              <Link to=\"/\" className=\"nav-link\">\n                &lsaquo; Back\n              </Link>\n            </li>\n          </ul>\n          <ul className=\"navbar-nav ml-auto mr-auto\">\n            <li className=\"navitem\">\n              <span className=\"navbar-text mr-3\">{this.state.romName}</span>\n            </li>\n          </ul>\n          <ul className=\"navbar-nav\" style={{ width: \"200px\" }}>\n            <li className=\"navitem\">\n              <Button\n                outline\n                color=\"primary\"\n                onClick={this.toggleControlsModal}\n                className=\"mr-3\"\n              >\n                Controls\n              </Button>\n              <Button\n                outline\n                color=\"primary\"\n                onClick={this.handlePauseResume}\n                disabled={!this.state.running}\n              >\n                {this.state.paused ? \"Resume\" : \"Pause\"}\n              </Button>\n            </li>\n          </ul>\n        </nav>\n\n        {this.state.error ? (\n          this.state.error\n        ) : (\n          <div\n            className=\"screen-container\"\n            ref={el => {\n              this.screenContainer = el;\n            }}\n          >\n            {this.state.loading ? (\n              <Progress\n                value={this.state.loadedPercent}\n                style={{\n                  position: \"absolute\",\n                  width: \"70%\",\n                  left: \"15%\",\n                  top: \"48%\"\n                }}\n              />\n            ) : this.state.romData ? (\n              <Emulator\n                romData={this.state.romData}\n                paused={this.state.paused}\n                ref={emulator => {\n                  this.emulator = emulator;\n                }}\n              />\n            ) : null}\n\n            {/*TODO: lift keyboard and gamepad state up */}\n            {this.state.controlsModalOpen && (\n              <ControlsModal\n                isOpen={this.state.controlsModalOpen}\n                toggle={this.toggleControlsModal}\n                keys={this.emulator.keyboardController.keys}\n                setKeys={this.emulator.keyboardController.setKeys}\n                promptButton={this.emulator.gamepadController.promptButton}\n                gamepadConfig={this.emulator.gamepadController.gamepadConfig}\n                setGamepadConfig={\n                  this.emulator.gamepadController.setGamepadConfig\n                }\n              />\n            )}\n            <NesController {...defaultPlayer1Controller} />\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.layout);\n    this.layout();\n    this.load();\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.layout);\n    if (this.currentRequest) {\n      this.currentRequest.abort();\n    }\n  }\n\n  load = () => {\n    if (this.props.match.params.slug) {\n      const slug = this.props.match.params.slug;\n      const isLocalROM = /^local-/.test(slug);\n      const romHash = slug.split(\"-\")[1];\n      const romInfo = isLocalROM\n        ? RomLibrary.getRomInfoByHash(romHash)\n        : config.ROMS[slug];\n\n      if (!romInfo) {\n        this.setState({ error: `No such ROM: ${slug}` });\n        return;\n      }\n\n      if (isLocalROM) {\n        this.setState({ romName: romInfo.name });\n        const localROMData = localStorage.getItem(\"blob-\" + romHash);\n        this.handleLoaded(localROMData);\n      } else {\n        this.setState({ romName: romInfo.description });\n        this.currentRequest = loadBinary(\n          romInfo.url,\n          (err, data) => {\n            if (err) {\n              this.setState({ error: `Error loading ROM: ${err.message}` });\n            } else {\n              this.handleLoaded(data);\n            }\n          },\n          this.handleProgress\n        );\n      }\n    } else if (this.props.location.state && this.props.location.state.file) {\n      let reader = new FileReader();\n      reader.readAsBinaryString(this.props.location.state.file);\n      reader.onload = e => {\n        this.currentRequest = null;\n        this.handleLoaded(reader.result);\n      };\n    } else {\n      this.setState({ error: \"No ROM provided\" });\n    }\n  };\n\n  handleProgress = e => {\n    if (e.lengthComputable) {\n      this.setState({ loadedPercent: (e.loaded / e.total) * 100 });\n    }\n  };\n\n  handleLoaded = data => {\n    this.setState({ running: true, loading: false, romData: data });\n  };\n\n  handlePauseResume = () => {\n    this.setState({ paused: !this.state.paused });\n  };\n\n  layout = () => {\n    let navbarHeight = parseFloat(window.getComputedStyle(this.navbar).height);\n    this.screenContainer.style.height = `${window.innerHeight -\n      navbarHeight}px`;\n    if (this.emulator) {\n      this.emulator.fitInParent();\n    }\n  };\n\n  toggleControlsModal = () => {\n    this.setState({ controlsModalOpen: !this.state.controlsModalOpen });\n  };\n}\n\nexport default RunPage;\n","import React, { Component } from \"react\";\nimport GoogleAnalytics from \"react-ga\";\nimport { BrowserRouter, Route } from \"react-router-dom\";\nimport ListPage from \"./ListPage\";\nimport RunPage from \"./RunPage\";\nimport config from \"./config\";\nimport { handleError } from \"./utils\";\nimport \"./App.css\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { error: null };\n    if (config.GOOGLE_ANALYTICS_CODE) {\n      GoogleAnalytics.initialize(config.GOOGLE_ANALYTICS_CODE);\n    }\n  }\n\n  render() {\n    if (this.state.error) {\n      return (\n        <div className=\"container my-4\">\n          <div className=\"row justify-content-center\">\n            <div className=\"col-md-8\">\n              Oops - there has been an error. It has been logged to the console.\n            </div>\n          </div>\n        </div>\n      );\n    }\n    return (\n      <BrowserRouter basename={config.BASENAME()}>\n        <div className=\"App\">\n          <Route exact path=\"/\" component={ListPage} />\n          <Route exact path=\"/run\" component={RunPage} />\n          <Route exact path=\"/run/:slug\" component={RunPage} />\n          <Route path=\"/\" render={this.recordPageview} />\n        </div>\n      </BrowserRouter>\n    );\n  }\n\n  componentDidCatch(error, errorInfo) {\n    this.setState({ error });\n    handleError(error, errorInfo);\n  }\n\n  recordPageview = ({ location }) => {\n    GoogleAnalytics.pageview(location.pathname);\n    return null;\n  };\n}\n\nexport default App;\n","import Raven from \"raven-js\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport config from \"./config\";\nimport \"./index.scss\";\n\nif (config.SENTRY_URI) {\n  Raven.config(config.SENTRY_URI).install();\n}\n\nRaven.context(function() {\n  ReactDOM.render(<App />, document.getElementById(\"root\"));\n});\n"],"sourceRoot":""}